import{j as e}from"./index-cd94da5a.js";import{r as s}from"./vendor-d6555781.js";import{u as a}from"./index-1f3c6b67.js";import{P as l}from"./index-629bb217.js";import{x as t,y as r,t as n,D as i,A as o,p as d,X as c,g as m,ac as h,h as u,j as x,U as p,W as g,b}from"./ui-eef567c7.js";const HouseholdCreate=({onCreate:l})=>{const[j,v]=s.useState(1),[f,y]=s.useState({name:"",address:"",image:null,coordinates:null,noFormalAddress:!1,householdType:"freestanding",scope:"my_dwelling",description:"",dwellings:1,families:1,units:[{id:1,type:"main",members:1,description:""}],members:[],connectionPreferences:{primary:"wifi_bluetooth",internetSync:"weekly",guestAccess:"wifi_bluetooth"},guests:[]}),[N,w]=s.useState({}),[C,k]=s.useState(!1),[_,S]=s.useState(!1),[A,F]=s.useState([]),[I,P]=s.useState(!1),[M,E]=s.useState(""),[$,O]=s.useState(""),[D,U]=s.useState(null),[T,G]=s.useState({name:"",phone:"",email:"",relationship:"family",role:"family",roleCustom:"",unit:1,customFields:[]}),H="undefined"!=typeof navigator&&!(!navigator.contacts||!navigator.contacts.select),R=s.useCallback(e=>{const s=e[0];s&&y(e=>({...e,image:Object.assign(s,{preview:URL.createObjectURL(s)})}))},[]),{getRootProps:X,getInputProps:B}=a({onDrop:R,accept:{"image/*":[]},maxFiles:1}),validatePhoneNumber=e=>{if(!e.trim())return!0;return/^(\+27|27|0)[6-8][0-9]{8}$/.test(e.replace(/\s+/g,""))||/^\+[1-9]\d{1,14}$/.test(e.replace(/\s+/g,""))},validateEmail=e=>{if(!e.trim())return!0;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},validateAddress=async e=>{if(f.noFormalAddress)return{valid:!!f.coordinates,message:f.coordinates?void 0:"Please set GPS pin if no formal address"};if(!e.trim())return{valid:!1,message:"Address is required"};S(!0);try{const s={valid:e.length>10,coordinates:e.length>10?{lat:.1*(Math.random()-.5)-26.2041,lng:28.0473+.1*(Math.random()-.5)}:null};return S(!1),s}catch(s){return S(!1),{valid:!1,message:"Address validation failed"}}},getDefaultPermissions=e=>{const s={canCommunicate:!0,canSendAlerts:!1,canApproveEvents:!1,canManageHousehold:!1,canInviteGuests:!1,communicationScope:"unit"};switch(e){case"father":case"mother":case"parent":return{...s,canSendAlerts:!0,canApproveEvents:!0,canManageHousehold:!0,canInviteGuests:!0,communicationScope:"household"};case"grandparent":return{...s,canSendAlerts:!0,canApproveEvents:!0,communicationScope:"household"};case"child":case"tenant":return{...s,communicationScope:"unit"};case"guest":return{...s,canCommunicate:!1,communicationScope:"none"};default:return s}},updateGuest=(e,s,a)=>{y(l=>({...l,guests:l.guests.map(l=>l.id===e?{...l,[s]:a}:l)}))},updateUnit=(e,s,a)=>{y(l=>({...l,units:l.units.map(l=>l.id===e?{...l,[s]:a}:l)}))},parseVcf=e=>{var s;const a=[],l=e.split("BEGIN:VCARD");for(const t of l){if(!t.includes("END:VCARD"))continue;const e={},l=t.split("\n");for(const a of l)if(a.startsWith("FN:")||a.startsWith("FN;"))e.name=null==(s=a.split(":")[1])?void 0:s.trim();else if(a.startsWith("TEL")&&!e.phone){const s=a.match(/:(.*)/);s&&(e.phone=s[1].trim())}else if(a.startsWith("EMAIL")&&!e.email){const s=a.match(/:(.*)/);s&&(e.email=s[1].trim())}(e.name||e.phone||e.email)&&a.push(e)}return a},updateCustomField=(e,s,a)=>{G(l=>({...l,customFields:l.customFields.map((l,t)=>t===e?{...l,[s]:a}:l)}))},updateMember=(e,s,a)=>{y(l=>({...l,members:l.members.map(l=>{if(l.id===e){const e={...l,[s]:a};return"role"===s&&(e.permissions=getDefaultPermissions(a)),e}return l})}))},nextStep=async()=>{if(1===j){if(!f.name.trim())return void w({name:"Household name is required"});if(f.noFormalAddress){if(!f.coordinates)return void w({address:"Please set GPS pin when no formal address is available"})}else{if(!f.address.trim())return void w({address:"Address is required"});const e=await validateAddress(f.address);if(!e.valid)return void w({address:e.message||"Invalid address"});f.coordinates||y(s=>({...s,coordinates:e.coordinates}))}}w({}),v(j+1)},prevStep=()=>{v(j-1)};return e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Create Household"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Step ",j," of 4"]})]}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3,4].map(s=>e.jsx("div",{className:"flex-1 h-2 rounded "+(s<=j?"bg-primary-500":"bg-gray-200")},s))})]}),1===j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Household Name"}),e.jsx("input",{className:"w-full p-3 border rounded-lg "+(N.name?"border-red-500":""),placeholder:"e.g., Smith Family Household",value:f.name,onChange:e=>y(s=>({...s,name:e.target.value}))}),N.name&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:N.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Household Image (Optional)"}),e.jsxs("div",{...X(),className:"p-6 border-2 border-dashed rounded-lg text-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("input",{...B()}),e.jsx(t,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{children:"Drag & drop an image here, or click to select a file."})]}),f.image&&e.jsxs("div",{className:"mt-4 relative w-32",children:[e.jsx("img",{src:f.image.preview,alt:"preview",className:"h-32 w-32 rounded-lg object-cover"}),e.jsx("button",{onClick:()=>{f.image&&(URL.revokeObjectURL(f.image.preview),y(e=>({...e,image:null})))},className:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1",children:e.jsx(r,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Household Type"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:f.householdType,onChange:e=>{const s=e.target.value,a={freestanding:"my_dwelling",flat_single:"my_floor",flat_complex:"my_unit",cluster:"my_unit",farm:"my_dwelling",compound:"my_dwelling",other:"my_dwelling"};y(e=>({...e,householdType:s,scope:a[s]||"my_dwelling"}))},children:[e.jsx("option",{value:"freestanding",children:"Freestanding House"}),e.jsx("option",{value:"flat_single",children:"Flat (Single Building)"}),e.jsx("option",{value:"flat_complex",children:"Flat (Complex)"}),e.jsx("option",{value:"cluster",children:"Cluster/Townhouse"}),e.jsx("option",{value:"farm",children:"Farm/Smallholding"}),e.jsx("option",{value:"compound",children:"Compound"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scope"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:f.scope,onChange:e=>y(s=>({...s,scope:e.target.value})),children:["freestanding"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_dwelling",children:"My dwelling/yard"}),e.jsx("option",{value:"entire_property",children:"Entire property"})]}),"flat_single"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_floor",children:"My floor"}),e.jsx("option",{value:"entire_building",children:"Entire building"}),e.jsx("option",{value:"my_unit",children:"My unit"})]}),"flat_complex"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_unit",children:"My unit"}),e.jsx("option",{value:"my_block",children:"My block"}),e.jsx("option",{value:"entire_complex",children:"Entire complex"})]}),"cluster"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_unit",children:"My unit"}),e.jsx("option",{value:"entire_estate",children:"Entire estate"})]}),"farm"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_dwelling",children:"My dwelling"}),e.jsx("option",{value:"entire_farm",children:"Entire farm/smallholding"})]}),"compound"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_dwelling",children:"My dwelling"}),e.jsx("option",{value:"entire_compound",children:"Entire compound"})]}),"other"===f.householdType&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"my_dwelling",children:"My dwelling"}),e.jsx("option",{value:"entire_property",children:"Entire property"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Address"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{disabled:f.noFormalAddress,className:`w-full p-3 border rounded-lg ${N.address?"border-red-500":f.coordinates?"border-green-500":""} ${f.noFormalAddress?"bg-gray-100 cursor-not-allowed":""}`,placeholder:f.noFormalAddress?"No formal address (use GPS pin)":"Enter full address (will be validated and GPS paired)",value:f.address,onChange:e=>y(s=>({...s,address:e.target.value}))}),_&&e.jsx("div",{className:"absolute right-3 top-3",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"})})]}),e.jsx("button",{onClick:()=>{k(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};y(e=>({...e,coordinates:s})),k(!1)},e=>{k(!1),alert("Unable to get your location. Please enter address manually.")}):(alert("Geolocation is not supported by this browser."),k(!1))},disabled:C,className:"px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-400",title:"Use current location",children:C?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsx(n,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[e.jsx("input",{id:"noFormalAddress",type:"checkbox",className:"mr-2",checked:f.noFormalAddress,onChange:e=>y(s=>({...s,noFormalAddress:e.target.checked,address:e.target.checked?"":s.address}))}),e.jsx("label",{htmlFor:"noFormalAddress",className:"text-sm text-gray-700",children:"No formal address (rural/informal). Use GPS pin instead."})]}),f.coordinates&&e.jsxs("div",{className:"text-sm text-green-600 mt-1 flex items-center",children:[e.jsx(i,{className:"h-4 w-4 mr-1"}),"GPS coordinates paired: ",f.coordinates.lat.toFixed(6),", ",f.coordinates.lng.toFixed(6)]}),N.address&&e.jsxs("div",{className:"text-sm text-red-600 mt-1 flex items-center",children:[e.jsx(o,{className:"h-4 w-4 mr-1"}),N.address]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Address will be validated and paired with GPS coordinates for emergency services"}),f.coordinates&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Latitude"}),e.jsx("input",{type:"number",step:"0.000001",className:"w-full p-2 border rounded",value:f.coordinates.lat,onChange:e=>y(s=>({...s,coordinates:{...s.coordinates,lat:parseFloat(e.target.value)||0}}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Longitude"}),e.jsx("input",{type:"number",step:"0.000001",className:"w-full p-2 border rounded",value:f.coordinates.lng,onChange:e=>y(s=>({...s,coordinates:{...s.coordinates,lng:parseFloat(e.target.value)||0}}))})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",className:"w-full p-2 bg-gray-100 border rounded hover:bg-gray-200",title:"Refine pin",onClick:()=>alert("Map pin refinement coming soon. For now, adjust lat/lng manually or use current location."),children:"Refine pin (map)"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description (Optional)"}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg",placeholder:"Brief description of the household",value:f.description,onChange:e=>y(s=>({...s,description:e.target.value})),rows:3})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:nextStep,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Next: Household Structure"})})]}),2===j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Number of Dwellings"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-3 border rounded-lg",value:f.dwellings,onChange:e=>y(s=>({...s,dwellings:parseInt(e.target.value)||1}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Number of Families"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-3 border rounded-lg",value:f.families,onChange:e=>y(s=>({...s,families:parseInt(e.target.value)||1}))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Units/Dwellings"}),e.jsxs("button",{onClick:()=>{const e={id:f.units.length+1,type:"rental",members:1,description:""};y(s=>({...s,units:[...s.units,e],dwellings:s.dwellings+1}))},className:"text-primary-600 hover:text-primary-700 text-sm flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-1"})," Add Unit"]})]}),e.jsx("div",{className:"space-y-3",children:f.units.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"font-medium",children:["Unit ",s.id]}),f.units.length>1&&e.jsx("button",{onClick:()=>{return e=s.id,void(f.units.length>1&&y(s=>({...s,units:s.units.filter(s=>s.id!==e),dwellings:s.dwellings-1})));var e},className:"text-red-500 hover:text-red-700",children:e.jsx(c,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{className:"p-2 border rounded",value:s.type,onChange:e=>updateUnit(s.id,"type",e.target.value),children:[e.jsx("option",{value:"main",children:"Main House"}),e.jsx("option",{value:"rental",children:"Rental Unit"}),e.jsx("option",{value:"guest",children:"Guest House"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx("input",{type:"number",min:"1",placeholder:"Members",className:"p-2 border rounded",value:s.members,onChange:e=>updateUnit(s.id,"members",parseInt(e.target.value)||1)})]}),e.jsx("input",{className:"w-full mt-2 p-2 border rounded",placeholder:"Unit description (optional)",value:s.description,onChange:e=>updateUnit(s.id,"description",e.target.value)})]},s.id))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:prevStep,className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Back"}),e.jsx("button",{onClick:nextStep,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Next: Add Members"})]})]}),3===j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Household Members"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{E("menu"),P(!0)},className:"px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600 flex items-center",children:[e.jsx(m,{className:"h-4 w-4 mr-1"})," Import Contacts"]}),e.jsxs("button",{onClick:()=>{const e={id:Date.now(),name:"",phone:"",email:"",relationship:"family",role:"family",roleCustom:"",unit:1,permissions:getDefaultPermissions("family"),customFields:{}};y(s=>({...s,members:[...s.members,e]}))},className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-1"})," Add Member"]})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:f.members.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"font-medium flex items-center",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Member ",f.members.indexOf(s)+1]}),e.jsx("button",{onClick:()=>{return e=s.id,void y(s=>({...s,members:s.members.filter(s=>s.id!==e)}));var e},className:"text-red-500 hover:text-red-700",children:e.jsx(c,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{className:"p-2 border rounded w-full "+(N[`member_${s.id}_name`]?"border-red-500":""),placeholder:"Full Name",value:s.name,onChange:e=>updateMember(s.id,"name",e.target.value)}),N[`member_${s.id}_name`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:N[`member_${s.id}_name`]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{className:"pl-8 p-2 border rounded w-full "+(N[`member_${s.id}_phone`]?"border-red-500":s.phone&&validatePhoneNumber(s.phone)?"border-green-500":""),placeholder:"+27 XX XXX XXXX",value:s.phone,onChange:e=>updateMember(s.id,"phone",e.target.value)})]}),N[`member_${s.id}_phone`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:N[`member_${s.id}_phone`]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{className:"pl-8 p-2 border rounded w-full "+(N[`member_${s.id}_email`]?"border-red-500":s.email&&validateEmail(s.email)?"border-green-500":""),placeholder:"email@example.com",value:s.email,onChange:e=>updateMember(s.id,"email",e.target.value)})]}),N[`member_${s.id}_email`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:N[`member_${s.id}_email`]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{className:"p-2 border rounded",value:s.role,onChange:e=>updateMember(s.id,"role",e.target.value),children:[e.jsxs("optgroup",{label:"Immediate family",children:[e.jsx("option",{value:"father",children:"Father"}),e.jsx("option",{value:"mother",children:"Mother"}),e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"spouse",children:"Spouse/Partner"}),e.jsx("option",{value:"child",children:"Child"}),e.jsx("option",{value:"sister",children:"Sister"}),e.jsx("option",{value:"brother",children:"Brother"})]}),e.jsxs("optgroup",{label:"Extended family",children:[e.jsx("option",{value:"grandmother",children:"Grandmother"}),e.jsx("option",{value:"grandfather",children:"Grandfather"}),e.jsx("option",{value:"uncle",children:"Uncle"}),e.jsx("option",{value:"aunt",children:"Aunt"}),e.jsx("option",{value:"cousin",children:"Cousin"}),e.jsx("option",{value:"mother_in_law",children:"Mother-in-law"}),e.jsx("option",{value:"father_in_law",children:"Father-in-law"}),e.jsx("option",{value:"sister_in_law",children:"Sister-in-law"}),e.jsx("option",{value:"brother_in_law",children:"Brother-in-law"})]}),e.jsxs("optgroup",{label:"Other",children:[e.jsx("option",{value:"friend",children:"Friend"}),e.jsx("option",{value:"tenant",children:"Tenant"}),e.jsx("option",{value:"caregiver",children:"Caregiver"}),e.jsx("option",{value:"custom",children:"Custom…"})]})]}),"custom"===s.role&&e.jsx("input",{className:"p-2 border rounded w-full",placeholder:"Describe relationship (e.g., godmother, cousin-in-law)",value:s.roleCustom||"",onChange:e=>updateMember(s.id,"roleCustom",e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Assign to Unit"}),e.jsx("select",{className:"p-2 border rounded w-full",value:s.unit,onChange:e=>updateMember(s.id,"unit",parseInt(e.target.value)||1),children:f.units.map(s=>e.jsxs("option",{value:s.id,children:["Unit ",s.id," - ",s.type," (",s.members," members)"]},s.id))})]})]}),e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"font-medium",children:["Permissions for ","custom"===s.role?s.roleCustom||"custom":s.role,":"]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-center",children:[e.jsx(x,{className:"h-3 w-3 mr-1"}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-1",checked:s.permissions.__customized||!1,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,__customized:e.target.checked})}),"Customize"]})]})]}),s.permissions.__customized?e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("label",{className:"text-xs inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:s.permissions.canCommunicate,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,canCommunicate:e.target.checked})}),"Can communicate"]}),e.jsxs("label",{className:"text-xs inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:s.permissions.canSendAlerts,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,canSendAlerts:e.target.checked})}),"Can send alerts"]}),e.jsxs("label",{className:"text-xs inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:s.permissions.canApproveEvents,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,canApproveEvents:e.target.checked})}),"Can approve events"]}),e.jsxs("label",{className:"text-xs inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:s.permissions.canManageHousehold,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,canManageHousehold:e.target.checked})}),"Can manage household"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Communication scope"}),e.jsxs("select",{className:"p-2 border rounded w-full",value:s.permissions.communicationScope,onChange:e=>updateMember(s.id,"permissions",{...s.permissions,communicationScope:e.target.value}),children:[e.jsx("option",{value:"unit",children:"Unit"}),e.jsx("option",{value:"household",children:"Household"}),e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"none",children:"None"})]})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs mt-1",children:[e.jsxs("div",{children:["Communicate: ",s.permissions.canCommunicate?"✓":"✗"]}),e.jsxs("div",{children:["Send Alerts: ",s.permissions.canSendAlerts?"✓":"✗"]}),e.jsxs("div",{children:["Approve Events: ",s.permissions.canApproveEvents?"✓":"✗"]}),e.jsxs("div",{children:["Manage Household: ",s.permissions.canManageHousehold?"✓":"✗"]}),e.jsxs("div",{className:"col-span-2",children:["Communication Scope: ",s.permissions.communicationScope]})]})]})]},s.id))}),0===f.members.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No members added yet. Add members or import from CSV."})]}),N.members&&e.jsx("div",{className:"text-red-500 text-sm",children:N.members}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:prevStep,className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Back"}),e.jsx("button",{onClick:nextStep,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Next: Connection & Guests"})]})]}),4===j&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center text-blue-800 dark:text-blue-200",children:[e.jsx(g,{className:"h-5 w-5 mr-2"}),"Connection Preferences"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Primary Connection Method"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:f.connectionPreferences.primary,onChange:e=>y(s=>({...s,connectionPreferences:{...s.connectionPreferences,primary:e.target.value}})),children:[e.jsx("option",{value:"wifi_bluetooth",children:"Wi-Fi & Bluetooth (Recommended - Offline First)"}),e.jsx("option",{value:"wifi_only",children:"Wi-Fi Only"}),e.jsx("option",{value:"bluetooth_only",children:"Bluetooth Only"}),e.jsx("option",{value:"internet_permanent",children:"Internet Permanent"}),e.jsx("option",{value:"internet_periodic",children:"Internet Periodic Updates"})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Choose how household devices primarily connect. Offline methods are more secure and private."})]}),f.connectionPreferences.primary.includes("internet")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Internet Sync Frequency"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:f.connectionPreferences.internetSync,onChange:e=>y(s=>({...s,connectionPreferences:{...s.connectionPreferences,internetSync:e.target.value}})),children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"font-semibold flex items-center text-green-800 dark:text-green-200",children:[e.jsx(b,{className:"h-5 w-5 mr-2"}),"Guest Access Management"]}),e.jsxs("button",{onClick:()=>{const e={id:Date.now(),name:"",phone:"",email:"",accessStart:(new Date).toISOString().split("T")[0],accessEnd:new Date(Date.now()+6048e5).toISOString().split("T")[0],accessType:"wifi_bluetooth",permissions:getDefaultPermissions("guest")};y(s=>({...s,guests:[...s.guests,e]}))},className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-1"})," Add Guest"]})]}),e.jsxs("div",{className:"space-y-3",children:[f.guests.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("span",{className:"font-medium",children:["Guest: ",s.name||"Unnamed"]}),e.jsx("button",{onClick:()=>{return e=s.id,void y(s=>({...s,guests:s.guests.filter(s=>s.id!==e)}));var e},className:"text-red-500 hover:text-red-700",children:e.jsx(c,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{className:"p-2 border rounded "+(N[`guest_${s.id}_name`]?"border-red-500":""),placeholder:"Guest Name",value:s.name,onChange:e=>updateGuest(s.id,"name",e.target.value)}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Phone (optional)",value:s.phone,onChange:e=>updateGuest(s.id,"phone",e.target.value)}),e.jsx("input",{className:"p-2 border rounded",placeholder:"Email (optional)",value:s.email,onChange:e=>updateGuest(s.id,"email",e.target.value)}),e.jsxs("select",{className:"p-2 border rounded",value:s.accessType,onChange:e=>updateGuest(s.id,"accessType",e.target.value),children:[e.jsx("option",{value:"wifi_bluetooth",children:"Wi-Fi & Bluetooth"}),e.jsx("option",{value:"wifi_only",children:"Wi-Fi Only"}),e.jsx("option",{value:"bluetooth_only",children:"Bluetooth Only"}),e.jsx("option",{value:"none",children:"No Access"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Access Start"}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded text-sm",value:s.accessStart,onChange:e=>updateGuest(s.id,"accessStart",e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Access End"}),e.jsx("input",{type:"date",className:"w-full p-2 border rounded text-sm",value:s.accessEnd,onChange:e=>updateGuest(s.id,"accessEnd",e.target.value)})]})]}),N[`guest_${s.id}_name`]&&e.jsx("div",{className:"text-red-500 text-xs mt-1",children:N[`guest_${s.id}_name`]})]},s.id)),0===f.guests.length&&e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(p,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No guests configured. Guests can have temporary access with specific connection permissions."})]})]})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Invite family and neighbors"}),e.jsx("div",{className:"text-sm text-gray-700 mb-2",children:"Each member gets a shareable link to join and sync later. You can also broadcast a household link."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:f.members.slice(0,6).map(s=>{const a=`${s.id.toString(36)}-${(s.name||"").split(" ").join("-").toLowerCase()}`,l=`${window.location.origin}/join/${a}`;return e.jsxs("div",{className:"p-2 border rounded text-xs",children:[e.jsxs("div",{className:"font-medium truncate",children:[s.name||"Unnamed"," • ",e.jsx("span",{className:"text-gray-500",children:s.role})]}),e.jsx("div",{className:"truncate text-gray-600",children:l}),e.jsxs("div",{className:"mt-1 flex space-x-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",onClick:()=>{var e;return null==(e=navigator.clipboard)?void 0:e.writeText(l)},children:"Copy"}),e.jsx("a",{className:"px-2 py-1 bg-green-100 rounded hover:bg-green-200",href:`https://wa.me/?text=${encodeURIComponent(l)}`,target:"_blank",rel:"noreferrer",children:"WhatsApp"}),e.jsx("a",{className:"px-2 py-1 bg-blue-100 rounded hover:bg-blue-200",href:`sms:?&body=${encodeURIComponent(l)}`,children:"SMS"}),e.jsx("a",{className:"px-2 py-1 bg-indigo-100 rounded hover:bg-indigo-200",href:`mailto:?subject=Join our household&body=${encodeURIComponent(l)}`,children:"Email"})]})]},s.id)})}),f.members.length>6&&e.jsx("div",{className:"text-xs text-gray-600 mt-2",children:"Showing first 6 members. You can send others from Household Management later."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:prevStep,className:"px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Back"}),e.jsx("button",{onClick:async()=>{if(!(await(async()=>{const e={};if(f.name.trim()||(e.name="Household name is required"),f.noFormalAddress)f.coordinates||(e.address="Please set GPS pin when no formal address is available");else if(f.address.trim()){const s=await validateAddress(f.address);s.valid?f.coordinates||y(e=>({...e,coordinates:s.coordinates})):e.address=s.message||"Invalid address format"}else e.address="Address is required";return 0===f.members.length&&(e.members="At least one member is required"),f.members.forEach((s,a)=>{s.name.trim()||(e[`member_${s.id}_name`]="Member name is required"),s.phone&&!validatePhoneNumber(s.phone)&&(e[`member_${s.id}_phone`]="Invalid phone number format"),s.email&&!validateEmail(s.email)&&(e[`member_${s.id}_email`]="Invalid email format")}),f.guests.forEach((s,a)=>{s.name.trim()||(e[`guest_${s.id}_name`]="Guest name is required"),s.phone&&!validatePhoneNumber(s.phone)&&(e[`guest_${s.id}_phone`]="Invalid phone number format"),s.email&&!validateEmail(s.email)&&(e[`guest_${s.id}_email`]="Invalid email format")}),w(e),0===Object.keys(e).length})()))return;const e={id:"h_"+Date.now(),...f,createdAt:Date.now()};l(e),y({name:"",address:"",coordinates:null,noFormalAddress:!1,householdType:"freestanding",scope:"my_dwelling",description:"",dwellings:1,families:1,units:[{id:1,type:"main",members:1,description:""}],members:[],connectionPreferences:{primary:"wifi_bluetooth",internetSync:"weekly",guestAccess:"wifi_bluetooth"},guests:[]}),v(1),w({})},className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Create Household"})]})]}),N.general&&e.jsx("div",{className:"mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:N.general}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Import Household Members"}),e.jsx("button",{onClick:()=>{P(!1),E(""),O(""),U(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"✕"})]}),""===M&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[H&&e.jsx("div",{className:"p-4 border-2 border-dashed border-purple-300 rounded-lg hover:border-purple-500 cursor-pointer",onClick:()=>{E("device"),(async()=>{try{if(!H)return void alert("Device contacts picker is not supported on this device/browser.");const e=["name","tel","email"],s={multiple:!0},a=(await navigator.contacts.select(e,s)).map(e=>({name:Array.isArray(e.name)?e.name[0]:e.name||"",phone:Array.isArray(e.tel)?e.tel[0]:e.tel||"",email:Array.isArray(e.email)?e.email[0]:e.email||""}));F(a),P(!0)}catch(e){alert("Unable to access device contacts. Please add members manually.")}})()},children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"h-12 w-12 mx-auto text-purple-500 mb-2"}),e.jsx("h4",{className:"font-medium text-purple-700",children:"Pick from Phone"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Access your device contacts"})]})}),e.jsxs("label",{className:"p-4 border-2 border-dashed border-green-300 rounded-lg hover:border-green-500 cursor-pointer block",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(t,{className:"h-12 w-12 mx-auto text-green-500 mb-2"}),e.jsx("h4",{className:"font-medium text-green-700",children:"Upload CSV"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import from spreadsheet"})]}),e.jsx("input",{type:"file",accept:".csv",onChange:e=>{(e=>{const s=e.target.files[0];if(!s)return;const a=new FileReader;a.onload=e=>{try{const s=e.target.result.split("\n"),a=s[0].split(",").map(e=>e.trim().toLowerCase()),l=[];for(let e=1;e<s.length;e++)if(s[e].trim()){const t=s[e].split(","),r={};a.forEach((e,s)=>{var a;r[e]=(null==(a=t[s])?void 0:a.trim())||""}),(r.name||r.firstname||r.lastname)&&l.push({id:Date.now()+e,name:r.name||`${r.firstname||""} ${r.lastname||""}`.trim(),phone:r.phone||r.mobile||"",email:r.email||"",relationship:r.relationship||"family",unit:1,customFields:r})}y(e=>({...e,members:[...e.members,...l]})),alert(`Imported ${l.length} contacts successfully!`)}catch(s){alert("Error parsing CSV file. Please check the format.")}},a.readAsText(s)})(e),P(!1)},className:"hidden"})]}),e.jsxs("label",{className:"p-4 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 cursor-pointer block",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(t,{className:"h-12 w-12 mx-auto text-blue-500 mb-2"}),e.jsx("h4",{className:"font-medium text-blue-700",children:"Upload VCF"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import from vCard file"})]}),e.jsx("input",{type:"file",accept:".vcf",onChange:e=>{(e=>{const s=e.target.files[0];if(!s)return;const a=new FileReader;a.onload=e=>{try{const s=e.target.result,a=parseVcf(s).map((e,s)=>({id:Date.now()+s,name:e.name||"",phone:e.phone||"",email:e.email||"",relationship:"family",unit:1,customFields:e}));y(e=>({...e,members:[...e.members,...a]})),alert(`Imported ${a.length} contacts from VCF successfully!`)}catch(s){alert("Error parsing VCF file. Please check the format.")}},a.readAsText(s)})(e),P(!1)},className:"hidden"})]}),e.jsxs("label",{className:"p-4 border-2 border-dashed border-orange-300 rounded-lg hover:border-orange-500 cursor-pointer block",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(t,{className:"h-12 w-12 mx-auto text-orange-500 mb-2"}),e.jsx("h4",{className:"font-medium text-orange-700",children:"Upload JSON"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import from JSON file"})]}),e.jsx("input",{type:"file",accept:".json",onChange:e=>{(e=>{const s=e.target.files[0];if(!s)return;const a=new FileReader;a.onload=e=>{try{const s=JSON.parse(e.target.result),a=(Array.isArray(s)?s:[s]).map((e,s)=>({id:Date.now()+s,name:e.name||e.fullName||e.displayName||"",phone:e.phone||e.mobile||e.phoneNumber||"",email:e.email||e.emailAddress||"",relationship:e.relationship||"family",unit:1,customFields:e}));y(e=>({...e,members:[...e.members,...a]})),alert(`Imported ${a.length} contacts from JSON successfully!`)}catch(s){alert("Error parsing JSON file. Please check the format.")}},a.readAsText(s)})(e),P(!1)},className:"hidden"})]}),e.jsx("div",{className:"p-4 border-2 border-dashed border-red-300 rounded-lg hover:border-red-500 cursor-pointer md:col-span-2",onClick:()=>E("paste"),children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-12 w-12 mx-auto text-red-500 mb-2"}),e.jsx("h4",{className:"font-medium text-red-700",children:"Paste JSON (AI Convert)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Paste any JSON format and let AI convert it"})]})}),e.jsx("div",{className:"p-4 border-2 border-dashed border-indigo-300 rounded-lg hover:border-indigo-500 cursor-pointer md:col-span-2",onClick:()=>E("manual"),children:e.jsxs("div",{className:"text-center",children:[e.jsx(d,{className:"h-12 w-12 mx-auto text-indigo-500 mb-2"}),e.jsx("h4",{className:"font-medium text-indigo-700",children:"Create Manually"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add contact details manually with custom fields"})]})})]}),"device"===M&&H&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Select Contacts to Import"}),e.jsx("button",{onClick:()=>E(""),className:"text-blue-500 hover:text-blue-700",children:"← Back to options"})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:A.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.phone," • ",s.email]})]}),e.jsx("button",{onClick:()=>{(e=>{const s={id:Date.now(),name:e.name,phone:e.phone,email:e.email,relationship:"family",role:"family",unit:1,permissions:getDefaultPermissions("family"),customFields:{}};y(e=>({...e,members:[...e.members,s]}))})(s),F(e=>e.filter(e=>e.name!==s.name))},className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Import"})]},s.name))}),e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx("button",{onClick:()=>{P(!1),E("")},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Done"})})]}),"paste"===M&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Paste JSON (AI Conversion)"}),e.jsx("button",{onClick:()=>E(""),className:"text-blue-500 hover:text-blue-700",children:"← Back to options"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Paste your JSON data:"}),e.jsx("textarea",{className:"w-full h-48 p-3 border rounded-lg font-mono text-sm",placeholder:'[{"name": "John Doe", "phone": "+1234567890", "email": "john@example.com"}]',value:$,onChange:e=>O(e.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>(async e=>{try{const s=JSON.parse(e),a=[];if(Array.isArray(s))for(const e of s){const s={name:e.name||e.full_name||e.display_name||e.first_name+" "+e.last_name||"",phone:e.phone||e.mobile||e.phone_number||e.cell||"",email:e.email||e.email_address||e.mail||"",relationship:e.relationship||e.relation||"family"};(s.name||s.phone||s.email)&&a.push(s)}else{const e={name:s.name||s.full_name||s.display_name||"",phone:s.phone||s.mobile||s.phone_number||"",email:s.email||s.email_address||"",relationship:s.relationship||"family"};(e.name||e.phone||e.email)&&a.push(e)}return U(a),a}catch(s){return alert("Error converting JSON. Please check the format."),[]}})($),disabled:!$.trim(),className:"px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Convert with AI"}),e.jsx("button",{onClick:()=>E(""),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]}),D&&e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-2",children:"Conversion Result:"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:D.map((s,a)=>e.jsxs("div",{className:"text-sm bg-white p-2 rounded border",children:[e.jsx("strong",{children:s.name})," • ",s.phone," • ",s.email]},a))}),e.jsxs("div",{className:"mt-4 flex space-x-2",children:[e.jsxs("button",{onClick:()=>{if(!D)return;const e=D.map((e,s)=>({id:Date.now()+s,name:e.name||"",phone:e.phone||"",email:e.email||"",relationship:e.relationship||"family",unit:1,customFields:e}));y(s=>({...s,members:[...s.members,...e]})),alert(`Imported ${e.length} contacts successfully!`),O(""),U(null),E("")},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:["Import ",D.length," Contacts"]}),e.jsx("button",{onClick:()=>U(null),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Clear"})]})]})]})]}),"manual"===M&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Create Contact Manually"}),e.jsx("button",{onClick:()=>E(""),className:"text-blue-500 hover:text-blue-700",children:"← Back to options"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg",placeholder:"Enter full name",value:T.name,onChange:e=>G(s=>({...s,name:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",className:"w-full p-3 border rounded-lg",placeholder:"+27 XX XXX XXXX",value:T.phone,onChange:e=>G(s=>({...s,phone:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full p-3 border rounded-lg",placeholder:"email@example.com",value:T.email,onChange:e=>G(s=>({...s,email:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Relationship"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:T.relationship,onChange:e=>G(s=>({...s,relationship:e.target.value})),children:[e.jsx("option",{value:"family",children:"Family"}),e.jsx("option",{value:"friend",children:"Friend"}),e.jsx("option",{value:"colleague",children:"Colleague"}),e.jsx("option",{value:"neighbor",children:"Neighbor"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsxs("select",{className:"w-full p-3 border rounded-lg",value:T.role,onChange:e=>G(s=>({...s,role:e.target.value})),children:[e.jsx("option",{value:"father",children:"Father"}),e.jsx("option",{value:"mother",children:"Mother"}),e.jsx("option",{value:"son",children:"Son"}),e.jsx("option",{value:"daughter",children:"Daughter"}),e.jsx("option",{value:"brother",children:"Brother"}),e.jsx("option",{value:"sister",children:"Sister"}),e.jsx("option",{value:"grandfather",children:"Grandfather"}),e.jsx("option",{value:"grandmother",children:"Grandmother"}),e.jsx("option",{value:"uncle",children:"Uncle"}),e.jsx("option",{value:"aunt",children:"Aunt"}),e.jsx("option",{value:"cousin",children:"Cousin"}),e.jsx("option",{value:"in-law",children:"In-law"}),e.jsx("option",{value:"tenant",children:"Tenant"}),e.jsx("option",{value:"family",children:"Other Family"}),e.jsx("option",{value:"friend",children:"Friend"}),e.jsx("option",{value:"other",children:"Other"})]})]}),"other"===T.role&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Custom Role"}),e.jsx("input",{type:"text",className:"w-full p-3 border rounded-lg",placeholder:"Specify the role",value:T.roleCustom,onChange:e=>G(s=>({...s,roleCustom:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unit"}),e.jsx("select",{className:"w-full p-3 border rounded-lg",value:T.unit,onChange:e=>G(s=>({...s,unit:parseInt(e.target.value)})),children:f.units.map(s=>e.jsxs("option",{value:s.id,children:["Unit ",s.id," - ",s.type," (",s.members," members)"]},s.id))})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h5",{className:"text-md font-medium",children:"Custom Fields"}),e.jsxs("button",{onClick:()=>{G(e=>({...e,customFields:[...e.customFields,{key:"",value:""}]}))},className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-1"})," Add Field"]})]}),e.jsx("div",{className:"space-y-2",children:T.customFields.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 p-2 border rounded",placeholder:"Field name (e.g., Occupation)",value:s.key,onChange:e=>updateCustomField(a,"key",e.target.value)}),e.jsx("input",{type:"text",className:"flex-1 p-2 border rounded",placeholder:"Field value (e.g., Teacher)",value:s.value,onChange:e=>updateCustomField(a,"value",e.target.value)}),e.jsx("button",{onClick:()=>(e=>{G(s=>({...s,customFields:s.customFields.filter((s,a)=>a!==e)}))})(a),className:"p-2 text-red-500 hover:text-red-700",children:e.jsx(c,{className:"h-4 w-4"})})]},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx("button",{onClick:()=>E(""),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:()=>{if(!T.name.trim())return void alert("Please enter a name for the contact");const e={id:Date.now(),name:T.name,phone:T.phone,email:T.email,relationship:T.relationship,role:T.role,roleCustom:T.roleCustom,unit:T.unit,permissions:getDefaultPermissions(T.role),customFields:T.customFields.reduce((e,s)=>(s.key.trim()&&(e[s.key.trim()]=s.value),e),{})};y(s=>({...s,members:[...s.members,e]})),G({name:"",phone:"",email:"",relationship:"family",role:"family",roleCustom:"",unit:1,customFields:[]}),alert("Contact added successfully!"),E("")},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Add Contact"})]})]})]})})})]})};HouseholdCreate.propTypes={onCreate:l.func.isRequired};const AlertCard=({alert:a,onConfirm:l})=>{const[t,r]=s.useState(!1),handleConfirm=e=>{if(t)return;r(!0);const s={userId:"local_user",time:Date.now(),verdict:e};l(a.id,s),setTimeout(()=>r(!1),250)},n=a.confirmations||[];return e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:new Date(a.createdAt).toLocaleString()}),e.jsx("h4",{className:"text-lg font-semibold",children:a.category}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Status: ",e.jsx("span",{className:"font-medium",children:a.status})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Confirms: ",n.length]})]}),e.jsx("p",{className:"mt-2 text-gray-700 dark:text-gray-200",children:a.message}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:()=>handleConfirm("confirm"),className:"px-3 py-1 bg-green-600 text-white rounded",children:"I confirm"}),e.jsx("button",{onClick:()=>handleConfirm("not_affected"),className:"px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded",children:"Not affected"}),e.jsx("button",{onClick:()=>handleConfirm("need_help"),className:"px-3 py-1 bg-yellow-500 text-white rounded",children:"Need help"})]})]})};export{AlertCard as A,HouseholdCreate as H};
