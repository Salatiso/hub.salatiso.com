import{j as e,G as s,x as a,y as t}from"./index-0094ed61.js";import{r}from"./vendor-ea3cc270.js";import{x as l,m as n,p as i,u as o,I as c}from"./firebase-147eafc7.js";import{z as d,r as u,u as p,Z as x,v as m,A as g,ah as b,T as h,X as j}from"./ui-a8f8a709.js";import{a as v,b as y,c as f}from"./layoutHelpers-b7eca1f0.js";import"./i18n-80c88d68.js";const N=r.memo(function({asset:s,typeColors:a,onEdit:t,onDelete:r}){return e.jsx("div",{className:`rounded-lg p-6 border-l-4 hover:shadow-md transition-shadow ${a[s.type]||a.other}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.name}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-white bg-opacity-70",children:s.type})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Value"}),e.jsxs("p",{className:"font-bold text-lg",children:["R",parseFloat(s.value).toLocaleString("en-ZA",{maximumFractionDigits:0})]})]}),s.depreciation>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Current Value"}),e.jsxs("p",{className:"font-bold text-lg",children:["R",(parseFloat(s.value)-parseFloat(s.depreciation)).toLocaleString("en-ZA",{maximumFractionDigits:0})]})]}),s.purchaseDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Purchased"}),e.jsx("p",{className:"font-semibold",children:s.purchaseDate})]}),s.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Location"}),e.jsx("p",{className:"font-semibold",children:s.location})]}),s.serialNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Serial Number"}),e.jsx("p",{className:"font-semibold text-xs",children:s.serialNumber})]}),s.insuranceProvider&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Insurance"}),e.jsx("p",{className:"font-semibold",children:s.insuranceProvider})]})]}),s.description&&e.jsx("p",{className:"mt-3 text-gray-700",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(s),className:"p-2 text-blue-600 hover:bg-blue-200 rounded-lg","aria-label":`Edit asset: ${s.name}`,children:e.jsx(d,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(s.id),className:"p-2 text-red-600 hover:bg-red-200 rounded-lg","aria-label":`Delete asset: ${s.name}`,children:e.jsx(u,{className:"w-4 h-4"})})]})]})},s.id)});function Assets(){const{guestData:d,updateGuestData:u}=r.useContext(s),{user:w}=a(),[C,A]=r.useState((null==d?void 0:d.assets)||[]),[D,S]=r.useState(!1),[F,k]=r.useState(null),[P,V]=r.useState("idle"),[I,L]=r.useState(null),[R,U]=r.useState("all"),[E,Z]=r.useState({name:"",type:"property",value:"",depreciation:0,description:"",purchaseDate:"",location:"",serialNumber:"",insuranceProvider:"",insuranceValue:"",documents:[]});r.useEffect(()=>{if(!w)return;(async()=>{try{V("syncing");const e=n(t,"users",w.uid,"assets","inventory"),s=await i(e);if(s.exists()){const e=s.data();A(e.assets||[]),L(e.lastUpdatedAt)}V("success")}catch(e){V("error")}})();return l(n(t,"users",w.uid,"assets","inventory"),e=>{if(e.exists()){const s=e.data();A(s.assets||[]),L(s.lastUpdatedAt)}},e=>{})},[w]);const saveAssets=e=>{A(e),u(s=>({...s,assets:e})),(async e=>{if(w)try{V("syncing");const s=n(t,"users",w.uid,"assets","inventory");await o(s,{assets:e,lastUpdatedBy:"lifesync",lastUpdatedAt:c()}),L(new Date),V("success")}catch(s){V("error")}})(e)},M=r.useCallback(()=>{if(E.name&&E.value){if(F){const e=C.map(e=>e.id===F.id?{...F,...E,value:parseFloat(E.value),depreciation:parseFloat(E.depreciation),updatedAt:(new Date).toISOString()}:e);saveAssets(e),k(null)}else{const e={id:Date.now(),...E,value:parseFloat(E.value),depreciation:parseFloat(E.depreciation),createdAt:(new Date).toISOString()};saveAssets([...C,e])}Z({name:"",type:"property",value:"",depreciation:0,description:"",purchaseDate:"",location:"",serialNumber:"",insuranceProvider:"",insuranceValue:"",documents:[]}),S(!1)}else alert("Please fill in name and value")},[E,F,C]),q=r.useCallback(e=>{k(e),Z(e),S(!0)},[]),O=r.useCallback(e=>{confirm("Delete this asset?")&&saveAssets(C.filter(s=>s.id!==e))},[C]),T={property:"bg-blue-100 text-blue-800",vehicle:"bg-purple-100 text-purple-800",investment:"bg-green-100 text-green-800",equipment:"bg-orange-100 text-orange-800",document:"bg-yellow-100 text-yellow-800",photo:"bg-pink-100 text-pink-800",other:"bg-gray-100 text-gray-800"},$=r.useMemo(()=>"all"===R?C:C.filter(e=>e.type===R),[R,C]),G=r.useMemo(()=>$.reduce((e,s)=>e+(parseFloat(s.value)||0),0),[$]),z=r.useMemo(()=>$.reduce((e,s)=>e+(parseFloat(s.depreciation)||0),0),[$]),B=r.useMemo(()=>G-z,[G,z]);return e.jsxs("div",{className:v(),children:[e.jsxs("div",{className:y(),children:[e.jsxs("div",{children:[e.jsx("h1",{className:f(),children:"Assets & Resources"}),I&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Last synced: ",new Date(I).toLocaleTimeString()]})]}),e.jsxs("button",{onClick:()=>{S(!D),k(null)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Add new asset",children:[e.jsx(p,{className:"w-4 h-4"}),"Add Asset"]})]}),"idle"!==P&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2 "+("success"===P?"bg-green-50 text-green-700":"error"===P?"bg-red-50 text-red-700":"bg-blue-50 text-blue-700"),children:["syncing"===P&&e.jsx(x,{className:"w-4 h-4 animate-spin"}),"success"===P&&e.jsx(m,{className:"w-4 h-4"}),"error"===P&&e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"syncing"===P?"Syncing with Firebase...":"success"===P?"Synced successfully!":"Sync error - changes saved locally"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R",G.toLocaleString("en-ZA",{maximumFractionDigits:0})]})]}),e.jsx(b,{className:"w-10 h-10 text-blue-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Depreciation"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["R",z.toLocaleString("en-ZA",{maximumFractionDigits:0})]})]}),e.jsx(h,{className:"w-10 h-10 text-red-400 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Current Value"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["R",B.toLocaleString("en-ZA",{maximumFractionDigits:0})]})]}),e.jsx(h,{className:"w-10 h-10 text-green-400 opacity-50"})]})})]}),D&&e.jsxs("div",{className:"bg-blue-50 rounded-lg border-2 border-blue-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:F?"Edit Asset":"Add New Asset"}),e.jsx("button",{onClick:()=>{S(!1),k(null)},"aria-label":"Close form",children:e.jsx(j,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Asset Name *",value:E.name,onChange:e=>Z({...E,name:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Asset name"}),e.jsxs("select",{value:E.type,onChange:e=>Z({...E,type:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Asset type",children:[e.jsx("option",{value:"property",children:"Property"}),e.jsx("option",{value:"vehicle",children:"Vehicle"}),e.jsx("option",{value:"investment",children:"Investment"}),e.jsx("option",{value:"equipment",children:"Equipment"}),e.jsx("option",{value:"document",children:"Document"}),e.jsx("option",{value:"photo",children:"Photo/Media"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx("input",{type:"number",placeholder:"Value (R) *",value:E.value,onChange:e=>Z({...E,value:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Asset value",step:"0.01"}),e.jsx("input",{type:"number",placeholder:"Depreciation (R)",value:E.depreciation,onChange:e=>Z({...E,depreciation:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Depreciation amount",step:"0.01"}),e.jsx("input",{type:"date",value:E.purchaseDate,onChange:e=>Z({...E,purchaseDate:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Purchase date"}),e.jsx("input",{type:"text",placeholder:"Location",value:E.location,onChange:e=>Z({...E,location:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Asset location"}),e.jsx("input",{type:"text",placeholder:"Serial Number / ID",value:E.serialNumber,onChange:e=>Z({...E,serialNumber:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Serial number"}),e.jsx("input",{type:"text",placeholder:"Insurance Provider",value:E.insuranceProvider,onChange:e=>Z({...E,insuranceProvider:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Insurance provider"}),e.jsx("input",{type:"number",placeholder:"Insured Value (R)",value:E.insuranceValue,onChange:e=>Z({...E,insuranceValue:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Insurance value",step:"0.01"}),e.jsx("textarea",{placeholder:"Description",value:E.description,onChange:e=>Z({...E,description:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,"aria-label":"Asset description"})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx("button",{onClick:()=>{S(!1),k(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50","aria-label":"Cancel",children:"Cancel"}),e.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":F?"Update asset":"Create asset",children:[e.jsx(p,{className:"w-4 h-4"}),F?"Update":"Add"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","property","vehicle","investment","equipment","document","photo","other"].map(s=>e.jsx("button",{onClick:()=>U(s),className:"px-4 py-2 rounded-lg whitespace-nowrap transition-colors "+(R===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),"aria-pressed":R===s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),0===$.length?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center text-gray-500",children:["No assets in this category. ",e.jsx("button",{onClick:()=>{S(!0),k(null)},className:"text-blue-600 underline",children:"Create one!"})]}):e.jsx("div",{className:"space-y-4",children:$.map(s=>e.jsx(N,{asset:s,typeColors:T,onEdit:q,onDelete:O},s.id))})]})}export{Assets as default};
