import{j as e,G as a,q as t,r as s}from"./index-6c723d70.js";import{r as n}from"./vendor-d6555781.js";import{x as r,j as l,l as i,u as o,I as d}from"./firebase-fb364782.js";import{aO as c,m as u,s as g,t as m,U as x,u as h,y as b,p,Z as v,R as j,X as y,e as f,d as N,i as w}from"./ui-eef567c7.js";import{a as C,b as k,c as D}from"./layoutHelpers-b7eca1f0.js";import"./i18n-8b62e3c8.js";const S=n.memo(function({event:a,categoryColors:t,onEdit:s,onDelete:n}){return e.jsx("div",{className:`border-l-4 rounded-lg p-4 hover:shadow-md transition-shadow ${t[a.category]||t.personal}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold",children:a.title}),"none"!==a.recurring&&e.jsx(c,{className:"w-4 h-4"}),"none"!==a.reminder&&e.jsx(u,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),a.date," ",a.time&&`${a.time}`," ",a.endTime&&`- ${a.endTime}`]}),a.location&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),a.location]}),a.attendees&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),a.attendees]})]}),a.description&&e.jsx("p",{className:"mt-2 text-sm",children:a.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(a),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg","aria-label":`Edit event: ${a.title}`,children:e.jsx(h,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>n(a.id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg","aria-label":`Delete event: ${a.title}`,children:e.jsx(b,{className:"w-4 h-4"})})]})]})},a.id)});function Calendar(){const{guestData:c,updateGuestData:u}=n.useContext(a),{user:g}=t(),[m,x]=n.useState(new Date),[h,b]=n.useState((null==c?void 0:c.calendarEvents)||[]),[E,T]=n.useState(!1),[M,U]=n.useState(null),[F,A]=n.useState("month"),[$,Y]=n.useState("idle"),[L,O]=n.useState(null),[I,P]=n.useState({title:"",date:"",time:"",endTime:"",location:"",description:"",attendees:"",category:"personal",reminder:"30min",recurring:"none",color:"blue"});n.useEffect(()=>{if(!g)return;(async()=>{try{Y("syncing");const e=l(s,"users",g.uid,"calendar","events"),a=await i(e);if(a.exists()){const e=a.data();b(e.events||[]),O(e.lastUpdatedAt)}Y("success")}catch(e){Y("error")}})();return r(l(s,"users",g.uid,"calendar","events"),e=>{if(e.exists()){const a=e.data();b(a.events||[]),O(a.lastUpdatedAt)}},e=>{})},[g]);const saveEvents=e=>{b(e),u(a=>({...a,calendarEvents:e})),(async e=>{if(g)try{Y("syncing");const a=l(s,"users",g.uid,"calendar","events");await o(a,{events:e,lastUpdatedBy:"lifesync",lastUpdatedAt:d()}),O(new Date),Y("success")}catch(a){Y("error")}})(e)},R=n.useCallback(()=>{if(!I.title||!I.date)return void alert("Please fill in title and date");if(h.filter(e=>e.date===I.date&&e.time&&I.time&&!(I.endTime<e.time||I.time>(e.endTime||e.time))).length>0&&!M)alert("⚠️ Time conflict detected with existing event(s)");else{if(M){const e=h.map(e=>e.id===M.id?{...M,...I}:e);saveEvents(e),U(null)}else{const e={id:Date.now(),...I,createdAt:(new Date).toISOString()};saveEvents([...h,e])}P({title:"",date:"",time:"",endTime:"",location:"",description:"",attendees:"",category:"personal",reminder:"30min",recurring:"none",color:"blue"}),T(!1)}},[I,M,h]),W=n.useCallback(e=>{U(e),P(e),T(!0)},[]),B=n.useCallback(e=>{confirm("Delete this event?")&&saveEvents(h.filter(a=>a.id!==e))},[h]),G=n.useCallback(()=>{x(new Date(m.getFullYear(),m.getMonth()-1))},[m]),H=n.useCallback(()=>{x(new Date(m.getFullYear(),m.getMonth()+1))},[m]),q=m.toLocaleString("default",{month:"long",year:"numeric"}),Z=[],z=(J=m,new Date(J.getFullYear(),J.getMonth()+1,0).getDate());var J;const K=(e=>new Date(e.getFullYear(),e.getMonth(),1).getDay())(m);for(let e=0;e<K;e++)Z.push(null);for(let e=1;e<=z;e++)Z.push(new Date(m.getFullYear(),m.getMonth(),e));const Q={personal:"bg-blue-100 text-blue-800 border-blue-300",work:"bg-purple-100 text-purple-800 border-purple-300",meeting:"bg-orange-100 text-orange-800 border-orange-300",deadline:"bg-red-100 text-red-800 border-red-300",birthday:"bg-pink-100 text-pink-800 border-pink-300",holiday:"bg-green-100 text-green-800 border-green-300"},V=n.useMemo(()=>h.sort((e,a)=>new Date(e.date)-new Date(a.date)),[h]);return e.jsxs("div",{className:C(),children:[e.jsxs("div",{className:k(),children:[e.jsxs("div",{children:[e.jsx("h1",{className:D(),children:"Calendar"}),L&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Last synced: ",new Date(L).toLocaleTimeString()]})]}),e.jsxs("button",{onClick:()=>{T(!E),U(null)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Add new event",children:[e.jsx(p,{className:"w-4 h-4"}),"New Event"]})]}),"idle"!==$&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2 "+("success"===$?"bg-green-50 text-green-700":"error"===$?"bg-red-50 text-red-700":"bg-blue-50 text-blue-700"),children:["syncing"===$&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),"success"===$&&e.jsx(Check,{className:"w-4 h-4"}),"error"===$&&e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"syncing"===$?"Syncing with Firebase...":"success"===$?"Synced successfully!":"Sync error - changes saved locally"})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["month","week","day"].map(a=>e.jsx("button",{onClick:()=>A(a),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(F===a?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),"aria-pressed":F===a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),E&&e.jsxs("div",{className:"bg-blue-50 rounded-lg border-2 border-blue-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:M?"Edit Event":"Create New Event"}),e.jsx("button",{onClick:()=>{T(!1),U(null)},"aria-label":"Close form",children:e.jsx(y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Event Title *",value:I.title,onChange:e=>P({...I,title:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event title"}),e.jsx("input",{type:"date",value:I.date,onChange:e=>P({...I,date:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event date"}),e.jsxs("select",{value:I.category,onChange:e=>P({...I,category:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event category",children:[e.jsx("option",{value:"personal",children:"Personal"}),e.jsx("option",{value:"work",children:"Work"}),e.jsx("option",{value:"meeting",children:"Meeting"}),e.jsx("option",{value:"deadline",children:"Deadline"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"holiday",children:"Holiday"})]}),e.jsx("input",{type:"time",value:I.time,onChange:e=>P({...I,time:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event start time"}),e.jsx("input",{type:"time",value:I.endTime,onChange:e=>P({...I,endTime:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event end time"}),e.jsx("input",{type:"text",placeholder:"Location",value:I.location,onChange:e=>P({...I,location:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event location"}),e.jsxs("select",{value:I.reminder,onChange:e=>P({...I,reminder:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Reminder time",children:[e.jsx("option",{value:"none",children:"No reminder"}),e.jsx("option",{value:"15min",children:"15 minutes before"}),e.jsx("option",{value:"30min",children:"30 minutes before"}),e.jsx("option",{value:"1hour",children:"1 hour before"}),e.jsx("option",{value:"1day",children:"1 day before"})]}),e.jsxs("select",{value:I.recurring,onChange:e=>P({...I,recurring:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Recurring event",children:[e.jsx("option",{value:"none",children:"One-time"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]}),e.jsx("input",{type:"text",placeholder:"Attendees (comma-separated)",value:I.attendees,onChange:e=>P({...I,attendees:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event attendees"}),e.jsx("textarea",{placeholder:"Description",value:I.description,onChange:e=>P({...I,description:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,"aria-label":"Event description"})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx("button",{onClick:()=>{T(!1),U(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50","aria-label":"Cancel",children:"Cancel"}),e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":M?"Update event":"Create event",children:[e.jsx(p,{className:"w-4 h-4"}),M?"Update":"Create"]})]})]}),"month"===F&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("button",{onClick:G,className:"p-2 hover:bg-gray-100 rounded-lg","aria-label":"Previous month",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-2xl font-bold",children:q}),e.jsx("button",{onClick:H,className:"p-2 hover:bg-gray-100 rounded-lg","aria-label":"Next month",children:e.jsx(N,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"grid grid-cols-7 bg-gray-50 border-b",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>e.jsx("div",{className:"p-4 font-bold text-center border-r last:border-r-0",children:a},a))}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:Z.map((a,t)=>{const s=a?(e=>{const a=e.toISOString().split("T")[0];return h.filter(e=>e.date===a)})(a):[],n=a&&a.toDateString()===(new Date).toDateString();return e.jsx("div",{className:"min-h-32 p-2 border-r border-b last:border-r-0 "+(a?n?"bg-blue-50":"bg-white":"bg-gray-50"),children:a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold mb-1 "+(n?"text-blue-600 text-lg":""),children:a.getDate()}),e.jsxs("div",{className:"space-y-1 text-xs",children:[s.slice(0,3).map(a=>e.jsxs("div",{className:`${Q[a.category]||Q.personal} p-1 rounded truncate hover:opacity-80 cursor-pointer border`,onClick:()=>W(a),title:a.title,children:[a.time&&`${a.time} `,a.title]},a.id)),s.length>3&&e.jsxs("div",{className:"text-gray-500 px-1",children:["+",s.length-3," more"]})]})]})},t)})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4",children:[e.jsx(w,{className:"w-6 h-6 inline-block mr-2"}),"Upcoming Events (",h.length,")"]}),0===h.length?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center text-gray-500",children:["No events scheduled. ",e.jsx("button",{onClick:()=>T(!0),className:"text-blue-600 underline",children:"Create one!"})]}):e.jsx("div",{className:"space-y-3",children:V.map(a=>e.jsx(S,{event:a,categoryColors:Q,onEdit:W,onDelete:B},a.id))})]})]})}export{Calendar as default};
