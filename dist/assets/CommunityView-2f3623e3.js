import{j as e}from"./index-286a0f84.js";import{f as s,r as t}from"./vendor-c40a6ff5.js";import{H as r,A as i}from"./AlertCard-982c77e7.js";import"./firebase-fb364782.js";import"./i18n-53393985.js";import"./ui-ac866f5b.js";import"./index-1756af59.js";import"./index-92aac425.js";const n="lifesync_communities_v1",a="lifesync_alerts_v1",loadCommunities=()=>{try{return JSON.parse(localStorage.getItem(n)||"[]")}catch{return[]}},loadAlerts=()=>{try{return JSON.parse(localStorage.getItem(a)||"[]")}catch{return[]}},CommunityView=()=>{const{id:d}=s(),[o,l]=t.useState(()=>loadCommunities().find(e=>e.id===d)),[c,m]=t.useState(()=>loadAlerts().filter(e=>e.communityId===d).sort((e,s)=>s.createdAt-e.createdAt)),[h,u]=t.useState(""),[x,g]=t.useState("General"),[f,j]=t.useState(navigator.onLine);t.useEffect(()=>{const e=loadCommunities().find(e=>e.id===d);l(e)},[d]),t.useEffect(()=>{localStorage.setItem(a,JSON.stringify(loadAlerts().filter(e=>e.communityId!==d).concat(c)))},[c,d]),t.useEffect(()=>{const handleOnline=()=>j(!0),handleOffline=()=>j(!1);return window.addEventListener("online",handleOnline),window.addEventListener("offline",handleOffline),()=>{window.removeEventListener("online",handleOnline),window.removeEventListener("offline",handleOffline)}},[]);const p=t.useCallback((e,s)=>{m(t=>t.map(t=>{if(t.id!==e)return t;const r={...t,confirmations:[...t.confirmations||[],s]},i=o&&o.settings&&o.settings.confirmationsRequired||2;return r.confirmations.filter(e=>"confirm"===e.verdict).length>=i&&(r.status="confirmed"),r}))},[o]),v=t.useCallback(e=>{l(s=>{if(!s)return s;const t={...s,households:[...s.households||[],e]},r=loadCommunities().map(e=>e.id===d?t:e);return localStorage.setItem(n,JSON.stringify(r)),t})},[d]);return o?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:o.name}),e.jsx("p",{className:"text-gray-600",children:o.description})]}),e.jsx("div",{className:"px-3 py-1 rounded-full text-sm "+(f?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:f?"Online":"Offline"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Report an Alert"}),e.jsxs("select",{value:x,onChange:e=>g(e.target.value),className:"mb-2 p-2 border rounded w-full",children:[e.jsx("option",{children:"Medical"}),e.jsx("option",{children:"Fire"}),e.jsx("option",{children:"Crime"}),e.jsx("option",{children:"Infrastructure"}),e.jsx("option",{children:"General"})]}),e.jsx("textarea",{value:h,onChange:e=>u(e.target.value),className:"w-full mb-2 p-2 border rounded",placeholder:"Describe the situation (short)"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>{if(!h.trim())return;const e={id:"a_"+Date.now(),communityId:d,reporterId:"local_user",category:x,message:h.trim(),status:"pending",confirmations:[],createdAt:Date.now()};m(s=>[e,...s]),u("")},className:"px-4 py-2 bg-primary-600 text-white rounded",children:"Send Alert"})})]}),e.jsx("div",{children:e.jsx(r,{onCreate:v})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-3",children:["Households (",(o.households||[]).length,")"]}),0===(o.households||[]).length?e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded",children:"No households yet. Create one to get started."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(o.households||[]).map(s=>{var t;return e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded shadow-sm",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.address}),s.description&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["Members: ",(null==(t=s.members)?void 0:t.length)||0]})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Community Alerts"}),e.jsx("div",{className:"space-y-3",children:0===c.length?e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded",children:"No alerts for this community."}):c.map(s=>e.jsx(i,{alert:s,onConfirm:p},s.id))})]})]}):e.jsx("div",{className:"p-6",children:"Community not found."})};export{CommunityView as default};
