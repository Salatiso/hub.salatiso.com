import{j as e,G as s,s as a,w as l}from"./index-286a0f84.js";import{r as t,L as r}from"./vendor-c40a6ff5.js";import{x as n,j as i,l as d,u as c,I as o}from"./firebase-fb364782.js";import{y as m,q as x,Z as h,u as p,A as g,U as u,H as b,t as f,a as j}from"./ui-ac866f5b.js";import{a as y,b as N,c as v}from"./layoutHelpers-b7eca1f0.js";import"./i18n-53393985.js";const w=t.memo(function({member:s,onEdit:a,onDelete:l}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-lg",children:s.name.charAt(0)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg","aria-label":`Edit: ${s.name}`,children:e.jsx(m,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg","aria-label":`Delete: ${s.name}`,children:e.jsx(x,{className:"w-4 h-4"})})]})]}),e.jsx("h3",{className:"text-lg font-bold",children:s.name}),e.jsxs("div",{className:"flex gap-2 mt-2 flex-wrap",children:[s.relationship&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded capitalize",children:s.relationship}),s.isEmergencyContact&&e.jsx("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-800 rounded",children:"🚨 Emergency"})]}),e.jsxs("div",{className:"mt-4 space-y-1 text-sm text-gray-600",children:[s.dateOfBirth&&e.jsxs("p",{children:["🎂 Born: ",s.dateOfBirth]}),s.email&&e.jsxs("p",{children:["📧 ",s.email]}),s.phone&&e.jsxs("p",{children:["📱 ",s.phone]}),s.address&&e.jsxs("p",{children:["📍 ",s.address]})]})]})});function Family(){const{guestData:m,updateGuestData:x}=t.useContext(s),{user:C}=a(),[S,E]=t.useState((null==m?void 0:m.familyMembers)||[]),[B,D]=t.useState(!1),[M,A]=t.useState(null),[O,k]=t.useState("idle"),[F,U]=t.useState(null);t.useState(!1);const[R,G]=t.useState({name:"",relationship:"",dateOfBirth:"",phone:"",email:"",address:"",isEmergencyContact:!1});t.useEffect(()=>{if(!C)return;(async()=>{try{k("syncing");const e=i(l,"users",C.uid,"family","members"),s=await d(e);if(s.exists()&&s.data().items){const e=s.data().items;E(e),x(s=>({...s,familyMembers:e})),k("success"),U(new Date)}}catch(e){k("error")}})();const e=n(i(l,"users",C.uid,"family","members"),e=>{if(e.exists()){const s=e.data();if(s.items&&"lifesync"!==s.lastUpdatedBy){const e=s.items;E(e),x(s=>({...s,familyMembers:e}))}}});return()=>e()},[C]);const saveFamilyMembers=e=>{E(e),x(s=>({...s,familyMembers:e})),C&&(async e=>{if(C)try{k("syncing");const s=i(l,"users",C.uid,"family","members");await c(s,{items:e,lastUpdatedBy:"lifesync",updatedAt:o()}),k("success"),U(new Date)}catch(s){k("error")}})(e)},P=t.useCallback(()=>{if(!R.name)return void alert("Please enter a name");const e={id:Date.now().toString(),...R,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),lastUpdatedBy:"lifesync"};M?(saveFamilyMembers(S.map(s=>s.id===M.id?e:s)),A(null)):saveFamilyMembers([...S,e]),G({name:"",relationship:"",dateOfBirth:"",phone:"",email:"",address:"",isEmergencyContact:!1}),D(!1)},[R,M,S]),H=t.useCallback(e=>{A(e),G(e),D(!0)},[]),I=t.useCallback(e=>{confirm("Remove this family member?")&&saveFamilyMembers(S.filter(s=>s.id!==e))},[S]),T=t.useMemo(()=>S.filter(e=>e.isEmergencyContact),[S]),L=t.useMemo(()=>S.filter(e=>e.dateOfBirth).sort((e,s)=>{const a=new Date(e.dateOfBirth).getMonth(),l=new Date(s.dateOfBirth).getMonth(),t=(new Date).getMonth();return(a-t+12)%12-(l-t+12)%12}).slice(0,3),[S]);return e.jsxs("div",{className:y(),children:[e.jsxs("div",{className:N(),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:v(),children:"Family"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["syncing"===O&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(h,{className:"w-4 h-4 animate-spin"}),"Syncing..."]}),"success"===O&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(p,{className:"w-4 h-4"}),"Synced"]}),"error"===O&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(g,{className:"w-4 h-4"}),"Sync Error"]}),F&&"syncing"!==O&&e.jsx("span",{className:"text-gray-500 text-xs",children:F.toLocaleTimeString()})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(r,{to:"/family/tree",className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(u,{className:"w-4 h-4"}),"Family Tree"]}),e.jsxs(r,{to:"/family/timeline",className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(b,{className:"w-4 h-4"}),"Timeline"]}),e.jsxs("button",{onClick:()=>{M&&(A(null),G({name:"",relationship:"",dateOfBirth:"",phone:"",email:"",address:"",isEmergencyContact:!1})),D(!B)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":"Add family member",children:[e.jsx(f,{className:"w-4 h-4"}),M?"Cancel":"Add Member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mb-1",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Members"})]}),e.jsx("div",{className:"text-2xl font-bold",children:S.length})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-1",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Emergency"})]}),e.jsx("div",{className:"text-2xl font-bold",children:T.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-1",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Households"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"1"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 mb-1",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"Birthdays Soon"})]}),e.jsx("div",{className:"text-2xl font-bold",children:L.length})]})]}),B&&e.jsxs("div",{className:"bg-blue-50 rounded-lg border-2 border-blue-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:M?"Edit Family Member":"Add Family Member"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Name *",value:R.name,onChange:e=>G({...R,name:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Family member name"}),e.jsxs("select",{value:R.relationship,onChange:e=>G({...R,relationship:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Relationship",children:[e.jsx("option",{value:"",children:"Select Relationship"}),e.jsx("option",{value:"spouse",children:"Spouse"}),e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"sibling",children:"Sibling"}),e.jsx("option",{value:"child",children:"Child"}),e.jsx("option",{value:"grandparent",children:"Grandparent"}),e.jsx("option",{value:"grandchild",children:"Grandchild"}),e.jsx("option",{value:"relative",children:"Relative"})]}),e.jsx("input",{type:"date",value:R.dateOfBirth,onChange:e=>G({...R,dateOfBirth:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Date of birth"}),e.jsx("input",{type:"email",placeholder:"Email",value:R.email,onChange:e=>G({...R,email:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Email"}),e.jsx("input",{type:"tel",placeholder:"Phone",value:R.phone,onChange:e=>G({...R,phone:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Phone"}),e.jsx("input",{type:"text",placeholder:"Address",value:R.address,onChange:e=>G({...R,address:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Address"}),e.jsxs("label",{className:"flex items-center gap-2 col-span-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R.isEmergencyContact,onChange:e=>G({...R,isEmergencyContact:e.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Mark as emergency contact"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx("button",{onClick:()=>{D(!1),A(null),G({name:"",relationship:"",dateOfBirth:"",phone:"",email:"",address:"",isEmergencyContact:!1})},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":M?"Update member":"Add member",children:[e.jsx(f,{className:"w-4 h-4"}),M?"Update":"Add"]})]})]}),0===S.length?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"No family members added yet"}),e.jsx("p",{className:"text-sm",children:"Add family members to get started"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(s=>e.jsx(w,{member:s,onEdit:H,onDelete:I},s.id))}),T.length>0&&e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"🚨 Emergency Contacts"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.map(s=>e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border-l-4 border-red-600",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:s.name}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s.phone&&e.jsxs("p",{children:["📱 ",s.phone]}),s.email&&e.jsxs("p",{children:["📧 ",s.email]}),s.relationship&&e.jsxs("p",{children:["Relationship: ",s.relationship]})]})]},s.id))})]})]})}export{Family as default};
