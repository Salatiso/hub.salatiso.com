import{j as e,G as t,x as s,y as a}from"./index-0094ed61.js";import{r as l,L as r}from"./vendor-ea3cc270.js";import{x as i,m as n,p as o,u as d,I as c}from"./firebase-147eafc7.js";import{j as x,z as m,r as g,Z as p,v as u,A as b,u as h}from"./ui-a8f8a709.js";import{a as y,b as v,c as j}from"./layoutHelpers-b7eca1f0.js";import"./i18n-80c88d68.js";const f=l.memo(function({event:t,eventTypeEmoji:s,eventTypeColors:a,onEdit:l,onDelete:r}){return e.jsxs("div",{className:"relative mb-8 ml-20",children:[e.jsx("div",{className:"absolute -left-16 top-1 w-5 h-5 rounded-full border-4 border-white "+("birthday"===t.type?"bg-pink-600":"anniversary"===t.type?"bg-red-600":"celebration"===t.type?"bg-green-600":"memorial"===t.type?"bg-gray-600":"bg-blue-600")}),e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-6 border-l-4 hover:shadow-lg transition-shadow ${a[t.type]}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:[s[t.type]," ",t.title]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mt-1",children:[e.jsx(x,{className:"w-4 h-4"}),new Date(t.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full capitalize font-medium ${a[t.type]}`,children:t.type}),e.jsx("button",{onClick:()=>l(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg","aria-label":`Edit event: ${t.title}`,children:e.jsx(m,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(t.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg","aria-label":`Delete event: ${t.title}`,children:e.jsx(g,{className:"w-4 h-4"})})]})]}),t.photoUrl&&e.jsx("img",{src:t.photoUrl,alt:t.title,className:"w-full h-40 object-cover rounded-lg my-3"}),t.description&&e.jsx("p",{className:"text-gray-700 mt-2",children:t.description}),t.participants&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Participants:"})," ",t.participants]})})]})]},t.id)});function FamilyTimeline(){const{guestData:x,updateGuestData:m}=l.useContext(t),{user:g}=s(),[N,w]=l.useState((null==x?void 0:x.familyEvents)||[]),[C,k]=l.useState(!1),[E,D]=l.useState(null),[S,U]=l.useState("all"),[A,T]=l.useState("idle"),[M,B]=l.useState(null),[F,P]=l.useState({title:"",date:"",description:"",type:"milestone",participants:"",photoUrl:""});l.useEffect(()=>{if(!g)return;(async()=>{try{T("syncing");const e=n(a,"users",g.uid,"family","events"),t=await o(e);if(t.exists()&&t.data().items){const e=t.data().items.sort((e,t)=>new Date(t.date)-new Date(e.date));w(e),m(t=>({...t,familyEvents:e})),T("success"),B(new Date)}}catch(e){T("error")}})();const e=i(n(a,"users",g.uid,"family","events"),e=>{if(e.exists()){const t=e.data();if(t.items&&"lifesync"!==t.lastUpdatedBy){const e=t.items.sort((e,t)=>new Date(t.date)-new Date(e.date));w(e),m(t=>({...t,familyEvents:e}))}}});return()=>e()},[g]);const saveEvents=e=>{w(e),m(t=>({...t,familyEvents:e})),g&&(async e=>{if(g)try{T("syncing");const t=n(a,"users",g.uid,"family","events");await d(t,{items:e,lastUpdatedBy:"lifesync",updatedAt:c()}),T("success"),B(new Date)}catch(t){T("error")}})(e)},$=l.useCallback(()=>{if(!F.title||!F.date)return void alert("Please fill in title and date");const e={id:Date.now().toString(),...F,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),lastUpdatedBy:"lifesync"};E?(saveEvents(N.map(t=>t.id===E.id?e:t).sort((e,t)=>new Date(t.date)-new Date(e.date))),D(null)):saveEvents([...N,e].sort((e,t)=>new Date(t.date)-new Date(e.date))),P({title:"",date:"",description:"",type:"milestone",participants:"",photoUrl:""}),k(!1)},[F,E,N]),L=l.useCallback(e=>{D(e),P(e),k(!0)},[]),I=l.useCallback(e=>{confirm("Delete this event?")&&saveEvents(N.filter(t=>t.id!==e))},[N]),z={milestone:"bg-blue-100 text-blue-800 border-blue-300",birthday:"bg-pink-100 text-pink-800 border-pink-300",anniversary:"bg-red-100 text-red-800 border-red-300",celebration:"bg-green-100 text-green-800 border-green-300",memorial:"bg-gray-100 text-gray-800 border-gray-300"},G={milestone:"ðŸ“",birthday:"ðŸŽ‚",anniversary:"ðŸ’•",celebration:"ðŸŽ‰",memorial:"ðŸ•¯ï¸"},O=l.useMemo(()=>"all"===S?N:N.filter(e=>e.type===S),[S,N]),R=l.useMemo(()=>({total:N.length,birthdays:N.filter(e=>"birthday"===e.type).length,anniversaries:N.filter(e=>"anniversary"===e.type).length,celebrations:N.filter(e=>"celebration"===e.type).length,milestones:N.filter(e=>"milestone"===e.type).length,memorials:N.filter(e=>"memorial"===e.type).length}),[N]);return e.jsxs("div",{className:y(),children:[e.jsxs("div",{className:v(),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:j(),children:"Family Timeline"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:["syncing"===A&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(p,{className:"w-4 h-4 animate-spin"}),"Syncing..."]}),"success"===A&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(u,{className:"w-4 h-4"}),"Synced"]}),"error"===A&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(b,{className:"w-4 h-4"}),"Error"]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(r,{to:"/family",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Family"}),e.jsxs("button",{onClick:()=>{E&&(D(null),P({title:"",date:"",description:"",type:"milestone",participants:"",photoUrl:""})),k(!C)},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(h,{className:"w-4 h-4"}),E?"Cancel":"Add Event"]})]})]}),N.length>0&&e.jsxs("div",{className:"flex gap-2 mb-6 flex-wrap",children:[e.jsxs("button",{onClick:()=>U("all"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("all"===S?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["All Events (",N.length,")"]}),e.jsxs("button",{onClick:()=>U("milestone"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("milestone"===S?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ðŸ“ Milestones (",R.milestones,")"]}),e.jsxs("button",{onClick:()=>U("birthday"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("birthday"===S?"bg-pink-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ðŸŽ‚ Birthdays (",R.birthdays,")"]}),e.jsxs("button",{onClick:()=>U("anniversary"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("anniversary"===S?"bg-red-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ðŸ’• Anniversaries (",R.anniversaries,")"]}),e.jsxs("button",{onClick:()=>U("celebration"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("celebration"===S?"bg-green-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ðŸŽ‰ Celebrations (",R.celebrations,")"]}),e.jsxs("button",{onClick:()=>U("memorial"),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("memorial"===S?"bg-gray-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["ðŸ•¯ï¸ Memorials (",R.memorials,")"]})]}),C&&e.jsxs("div",{className:"bg-blue-50 rounded-lg border-2 border-blue-200 p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:E?"Edit Family Event":"Add Family Event"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Event Title *",value:F.title,onChange:e=>P({...F,title:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event title"}),e.jsx("input",{type:"date",value:F.date,onChange:e=>P({...F,date:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event date"}),e.jsxs("select",{value:F.type,onChange:e=>P({...F,type:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Event type",children:[e.jsx("option",{value:"milestone",children:"Milestone"}),e.jsx("option",{value:"birthday",children:"Birthday"}),e.jsx("option",{value:"anniversary",children:"Anniversary"}),e.jsx("option",{value:"celebration",children:"Celebration"}),e.jsx("option",{value:"memorial",children:"Memorial"})]}),e.jsx("input",{type:"text",placeholder:"Participants",value:F.participants,onChange:e=>P({...F,participants:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Participants"}),e.jsx("textarea",{placeholder:"Description",value:F.description,onChange:e=>P({...F,description:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,"aria-label":"Event description"}),e.jsx("input",{type:"url",placeholder:"Photo URL (optional)",value:F.photoUrl,onChange:e=>P({...F,photoUrl:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Photo URL"})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx("button",{onClick:()=>{k(!1),D(null),P({title:"",date:"",description:"",type:"milestone",participants:"",photoUrl:""})},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":E?"Update event":"Add event",children:[e.jsx(h,{className:"w-4 h-4"}),E?"Update":"Add"]})]})]}),0===O.length?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-12 text-center text-gray-500",children:[e.jsx("p",{className:"text-lg mb-4",children:"all"===S?"No family events yet":`No ${S} events found`}),e.jsxs("button",{onClick:()=>k(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":"Add first event",children:[e.jsx(h,{className:"w-4 h-4"}),"all"===S?"Add First Event":"Add Event"]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-6 top-0 bottom-0 w-1 bg-gradient-to-b from-blue-300 to-purple-300"}),O.map(t=>e.jsx(f,{event:t,eventTypeEmoji:G,eventTypeColors:z,onEdit:L,onDelete:I},t.id))]})}),N.length>0&&e.jsxs("div",{className:"mt-12 grid grid-cols-3 md:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:R.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:R.milestones}),e.jsx("div",{className:"text-xs text-gray-600",children:"Milestones"})]}),e.jsxs("div",{className:"bg-pink-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-pink-600",children:R.birthdays}),e.jsx("div",{className:"text-xs text-gray-600",children:"Birthdays"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:R.anniversaries}),e.jsx("div",{className:"text-xs text-gray-600",children:"Anniversaries"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:R.celebrations}),e.jsx("div",{className:"text-xs text-gray-600",children:"Celebrations"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-600",children:R.memorials}),e.jsx("div",{className:"text-xs text-gray-600",children:"Memorials"})]})]})]})}export{FamilyTimeline as default};
