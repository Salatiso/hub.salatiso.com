import{G as e,j as r,g as t,d as a,q as s,h as l}from"./index-0094ed61.js";import{r as i,u as d,i as o}from"./vendor-ea3cc270.js";import{B as n,G as c,D as x,E as g,H as m}from"./firebase-147eafc7.js";import{g as u,i as h}from"./portableProfile-9e4e3ab8.js";import{h as p,i as b,o as y,U as f,aJ as v}from"./ui-a8f8a709.js";import"./i18n-80c88d68.js";const GuestLoginPage=({onGuestCreated:j,className:w=""})=>{const{guestData:N,setGuestData:k}=i.useContext(e),S=d(),[P]=o(),[C,I]=i.useState("options"),[L,D]=i.useState(""),[A,O]=i.useState(""),[E,T]=i.useState(""),[F,G]=i.useState(""),[z,q]=i.useState(!1),[B,U]=i.useState(""),[H,R]=i.useState(""),[_,$]=i.useState(!1),[J,M]=i.useState("signup"===P.get("mode")?"register":"signin"),[Y,W]=i.useState(""),[K,X]=i.useState(!1),[Z,V]=i.useState(!1),[Q,ee]=i.useState([]),[re,te]=i.useState(!1),[ae,se]=i.useState([]),[le,ie]=i.useState(!1),[de,oe]=i.useState(null),[ne,ce]=i.useState("");i.useEffect(()=>{(async()=>{try{const e=await t.listLocalProfiles();ee(e),V(e.length>0)}catch(e){const r=localStorage.getItem("lifesync_guest");V(null!==r)}})(),(async()=>{try{await u.initialize(),te(u.isUserSignedIn())}catch(e){}})()},[]),i.useEffect(()=>{(async()=>{try{const r=await n(a);if(null==r?void 0:r.user){X(!0);const t=r.user;try{const e=await s(t.uid);if(e){const r=l(e);k(e=>{var a,s;return{...e,profile:{...e.profile,...r,deviceType:(null==(a=e.profile)?void 0:a.deviceType)||"mobile"},owner:{uid:t.uid,source:"lifesync"},role:r.role||e.role,servicesRegistered:(null==(s=r.servicesRegistered)?void 0:s.length)?r.servicesRegistered:e.servicesRegistered}})}else k(e=>{var r;return{...e,profile:{...e.profile,firstName:t.displayName?t.displayName.split(" ")[0]:"",lastName:t.displayName?t.displayName.split(" ").slice(1).join(" "):"",emails:[{id:1,address:t.email,label:"Personal"}],deviceType:(null==(r=e.profile)?void 0:r.deviceType)||"mobile"},owner:{uid:t.uid,source:"lifesync"}}})}catch(e){k(e=>{var r;return{...e,profile:{...e.profile,firstName:t.displayName?t.displayName.split(" ")[0]:"",lastName:t.displayName?t.displayName.split(" ").slice(1).join(" "):"",emails:[{id:1,address:t.email,label:"Personal"}],deviceType:(null==(r=e.profile)?void 0:r.deviceType)||"mobile"},owner:{uid:t.uid,source:"lifesync"}}})}S("/dashboard")}}catch(r){"auth/popup-closed-by-user"!==r.code&&W(r.message||"Failed to complete sign-in. Please try again.")}finally{X(!1)}})()},[S,k]);const handleGoogleSignIn=async()=>{var e;try{X(!0),W("");const e=new c;e.addScope("profile"),e.addScope("email"),await x(a,e)}catch(r){"auth/requests-from-referer-are-blocked"===(null==r?void 0:r.code)?W("⚠️ LOCALHOST NOT AUTHORIZED: Please add localhost:3000 to Firebase Console > Authentication > Authorized Domains. See GOOGLE_OAUTH_LOCALHOST_FIX.md for instructions."):"auth/operation-not-supported-in-this-environment"===(null==r?void 0:r.code)?W("⚠️ BROWSER ISSUE: Third-party cookies might be blocked. Try using a different browser or incognito mode."):"auth/popup-blocked"===(null==r?void 0:r.code)?W("⚠️ POPUP BLOCKED: Allow popups for this site and try again."):(null==(e=null==r?void 0:r.message)?void 0:e.includes("requests-from-referer"))?W("⚠️ LOCALHOST NOT AUTHORIZED: Please add localhost:3000 to Firebase Console > Authentication > Authorized Domains. See GOOGLE_OAUTH_LOCALHOST_FIX.md for instructions."):W(`Failed to sign in with Google: ${(null==r?void 0:r.message)||"Unknown error"}`),X(!1)}},loadGoogleDriveFiles=async()=>{try{const e=await u.listProfileFiles();se(e)}catch(e){}};return r.jsxs("div",{className:`min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 flex items-center justify-center p-4 ${w}`,children:["options"===C&&r.jsxs("div",{className:"max-w-4xl w-full",children:[r.jsxs("div",{className:"text-center mb-12",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4",children:r.jsx("span",{className:"text-3xl",children:"🚀"})}),r.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-3",children:"Get Started with LifeSync"}),r.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Choose how you'd like to begin"})]}),r.jsxs("div",{className:"grid gap-6 md:grid-cols-3 max-w-6xl mx-auto",children:[r.jsxs("div",{onClick:handleGoogleSignIn,role:"button",tabIndex:0,className:"group relative overflow-hidden bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 border-2 border-transparent hover:border-blue-500 h-full cursor-pointer",onKeyPress:e=>{"Enter"!==e.key&&" "!==e.key||handleGoogleSignIn()},children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50 to-transparent dark:from-blue-900/20 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"text-5xl mb-4",children:"☁️"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Continue with Google"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-sm",children:"Fastest option. Cloud backup & multi-device access."}),r.jsxs("ul",{className:"space-y-2 mb-6 text-left text-xs",children:[r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"⚡"})," One-click signin"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"☁️"})," Synced across devices"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"🔒"})," Secure authentication"]})]}),r.jsx("div",{className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-sm group-hover:shadow-lg text-center",children:"Continue with Google →"})]})]}),r.jsxs("div",{onClick:()=>I("localSignup"),className:"group relative overflow-hidden bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 border-2 border-transparent hover:border-green-500 h-full cursor-pointer disabled:opacity-50",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-50 to-transparent dark:from-green-900/20 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"text-5xl mb-4",children:"�"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Continue with Local Account"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-sm",children:"Works offline. PIN-protected. Sync later if you want."}),r.jsxs("ul",{className:"space-y-2 mb-6 text-left text-xs",children:[r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"📴"})," Works without internet"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"🔑"})," PIN or password protection"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"⬆️"})," Optional cloud sync"]})]}),r.jsx("div",{className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors text-sm group-hover:shadow-lg text-center",children:"Continue with Local →"})]})]}),r.jsxs("div",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json,.lifesync",e.onchange=async e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t)try{X(!0),W("");const e=await t.text();let r;try{r=JSON.parse(e)}catch(a){return W("Invalid file format. Please select a valid LifeSync profile file."),void X(!1)}await h(r,k);S("/dashboard")}catch(s){W("Failed to import profile. Please try again.")}finally{X(!1)}},e.click()},className:"group relative overflow-hidden bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 border-2 border-transparent hover:border-purple-500 h-full cursor-pointer",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50 to-transparent dark:from-purple-900/20 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"text-5xl mb-4",children:"💻"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import from Computer/Device"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-sm",children:"Load a profile file from your computer or device storage."}),r.jsxs("ul",{className:"space-y-2 mb-6 text-left text-xs",children:[r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"📂"})," Select file from device"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"🔐"})," Password protected"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"📄"})," JSON or LifeSync files"]})]}),r.jsx("div",{className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-colors text-sm group-hover:shadow-lg text-center",children:"Import from Device →"})]})]}),r.jsxs("div",{onClick:()=>ie(!0),className:"group relative overflow-hidden bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 border-2 border-transparent hover:border-red-500 h-full cursor-pointer",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-50 to-transparent dark:from-red-900/20 opacity-0 group-hover:opacity-100 transition-opacity"}),r.jsxs("div",{className:"relative z-10",children:[r.jsx("div",{className:"text-5xl mb-4",children:"📁"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Import from Google Drive"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-sm",children:"Load a previously exported profile from Google Drive."}),r.jsxs("ul",{className:"space-y-2 mb-6 text-left text-xs",children:[r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"📤"})," Import encrypted profiles"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"🔐"})," Password protected"]}),r.jsxs("li",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[r.jsx("span",{children:"📱"})," Cross-device mobility"]})]}),r.jsx("div",{className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors text-sm group-hover:shadow-lg text-center",children:"Import from Drive →"})]})]})]})]}),"emailAuth"===C&&r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(p,{className:"w-8 h-8 text-white"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"signin"===J?"Sign In":"Create Account"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"signin"===J?"Welcome back!":"Join the LifeSync community"})]}),r.jsxs("button",{onClick:handleGoogleSignIn,disabled:K,className:"w-full mb-6 flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:[r.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[r.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),r.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),r.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),r.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),r.jsxs("div",{className:"relative mb-6",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),r.jsx("div",{className:"relative flex justify-center text-sm",children:r.jsx("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500",children:"Or"})})]}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),E&&B)if("register"!==J||B===H)if("register"!==J||_)try{X(!0),W(""),"register"===J?await g(a,E,B):await m(a,E,B),S("/dashboard")}catch(r){const e=r;"auth/weak-password"===e.code?W("Password should be at least 6 characters"):"auth/email-already-in-use"===e.code?W("An account with this email already exists"):"auth/user-not-found"===e.code?W("No account found with this email"):"auth/wrong-password"===e.code?W("Incorrect password"):W("Authentication failed. Please try again.")}finally{X(!1)}else W("You must accept the Terms of Reciprocity to create an account");else W("Passwords do not match");else W("Please fill in all fields")},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),r.jsxs("div",{className:"relative",children:[r.jsx(b,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"email",value:E,onChange:e=>T(e.target.value),className:"w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email",required:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password"}),r.jsxs("div",{className:"relative",children:[r.jsx(y,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"password",value:B,onChange:e=>U(e.target.value),className:"w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password",required:!0})]})]}),"register"===J&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Confirm Password"}),r.jsxs("div",{className:"relative",children:[r.jsx(y,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"password",value:H,onChange:e=>R(e.target.value),className:"w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password",required:!0})]})]}),"register"===J&&r.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("input",{type:"checkbox",id:"terms-checkbox",checked:_,onChange:e=>$(e.target.checked),className:"mt-1 h-4 w-4 rounded border-gray-300 text-amber-600 focus:ring-amber-500 cursor-pointer",required:!0}),r.jsxs("label",{htmlFor:"terms-checkbox",className:"text-sm text-amber-800 dark:text-amber-200 cursor-pointer flex-1",children:[r.jsx("span",{className:"font-medium",children:"I accept the Terms of Reciprocity"}),r.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-1",children:["By creating an account, you agree to the principles of mutual respect, fair exchange, and community responsibility."," ",r.jsx("a",{href:"/terms/reciprocity",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-amber-900 dark:hover:text-amber-100",children:"Read full terms"})]})]})]})}),Y&&r.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:Y})}),r.jsx("button",{type:"submit",disabled:K||"register"===J&&!_,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:cursor-not-allowed",children:K?"Please wait...":"signin"===J?"Sign In":"Create Account"})]}),r.jsxs("div",{className:"mt-6 text-center space-y-3",children:[r.jsx("button",{onClick:()=>{M("signin"===J?"register":"signin"),W("")},className:"w-full text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm",children:"signin"===J?"Don't have an account? Sign up":"Already have an account? Sign in"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),r.jsx("div",{className:"relative flex justify-center text-xs",children:r.jsx("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500",children:"Or"})})]}),r.jsxs("button",{onClick:()=>I("localSignup"),className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white rounded-lg transition-all font-medium",children:[r.jsx(f,{className:"w-5 h-5"}),"Create a Local Account"]})]}),r.jsxs("button",{onClick:()=>I("options"),className:"w-full mt-4 flex items-center justify-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[r.jsx(v,{className:"w-4 h-4"}),"Back to Options"]})]}),"localSignin"===C&&r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8",children:[r.jsxs("button",{onClick:()=>I("options"),className:"flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 mb-6",children:[r.jsx(v,{className:"w-4 h-4"}),"Back"]}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Sign In to Local Account"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Enter your name and PIN or password to access your account."})]}),K?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-green-600 rounded-full mb-4 animate-spin",children:r.jsx("div",{className:"w-8 h-8 border-4 border-green-200 border-t-green-600 rounded-full"})}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Signing you in..."})]}):r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),W(""),L.trim()&&A.trim())if(!z&&F.length<4)W("Please enter your 4-digit PIN");else if(!z||B){X(!0);try{const e=`${L.trim()} ${A.trim()}`,r=z?B:F;if(!(await t.authenticateLocalProfile(e,{pin:r,usePassword:z})))return void W("Account not found or incorrect credentials");const a=(await t.listLocalProfiles()).find(r=>r.displayName===e);if(a){const e=await t.getLocalProfileData(a.id);k({...e,profile:{firstName:a.firstName,lastName:a.lastName,emails:a.email?[{id:1,address:a.email,label:"Personal"}]:[],deviceType:"mobile"},owner:a.owner||{source:"local"}}),S("/dashboard")}else W("Failed to load account data")}catch(r){W("Failed to sign in. Please try again.")}finally{X(!1)}}else W("Please enter your password");else W("Please enter your first and last name")},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"First Name *"}),r.jsx("input",{type:"text",value:L,onChange:e=>D(e.target.value),placeholder:"John",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Last Name *"}),r.jsx("input",{type:"text",value:A,onChange:e=>O(e.target.value),placeholder:"Doe",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),!z&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"4-Digit PIN *"}),r.jsx("input",{type:"password",value:F,onChange:e=>G(e.target.value.slice(0,4)),placeholder:"••••",maxLength:4,pattern:"[0-9]{4}",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-center text-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Enter the PIN you used when creating your account"})]}),z&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password *"}),r.jsx("input",{type:"password",value:B,onChange:e=>U(e.target.value),placeholder:"Enter your password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Enter the password you used when creating your account"})]}),r.jsx("div",{children:r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:z,onChange:e=>{q(e.target.checked),G(""),U("")},className:"w-4 h-4 rounded border-gray-300"}),"Use password instead of PIN"]})}),Y&&r.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:Y})}),r.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:r.jsxs("p",{className:"text-xs text-green-900 dark:text-green-100",children:["🔐 ",r.jsx("strong",{children:"Secure Access"})," Your local account data is stored securely on this device only."]})}),r.jsx("button",{type:"submit",disabled:K||!L.trim()||!A.trim()||!z&&F.length<4||z&&!B,className:"w-full px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:K?"Signing In...":"Sign In"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Forgot your PIN or password? You'll need to create a new local account."})]})]}),"localSignup"===C&&r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8",children:[r.jsxs("button",{onClick:()=>I("options"),className:"flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 mb-6",children:[r.jsx(v,{className:"w-4 h-4"}),"Back"]}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Local Account"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Enter your name and create or access your local account."})]}),K?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-purple-600 rounded-full mb-4 animate-spin",children:r.jsx("div",{className:"w-8 h-8 border-4 border-purple-200 border-t-purple-600 rounded-full"})}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Setting up your account..."})]}):r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),W(""),L.trim()&&A.trim())if(!z&&F.length<4)W("Please enter a 4-digit PIN");else if(z&&B.length<8)W("Password must be at least 8 characters");else{X(!0);try{const e=`${L.trim()} ${A.trim()}`,r=z?B:F,a=Q.find(r=>r.displayName===e);if(a){if(!(await t.authenticateLocalProfile(e,{pin:r,usePassword:z})))return void W("Incorrect PIN or password for existing account");const s=await t.getLocalProfileData(a.id);k({...s,profile:{firstName:a.firstName,lastName:a.lastName,emails:a.email?[{id:1,address:a.email,label:"Personal"}]:[],deviceType:"mobile"},owner:a.owner||{source:"local"}})}else{const a=await t.createLocalProfile(e,E.trim()||void 0,{pin:r,usePassword:z,firstName:L.trim(),lastName:A.trim()}),s={profile:{firstName:L.trim(),lastName:A.trim(),emails:E.trim()?[{id:1,address:E.trim(),label:"Personal"}]:[],deviceType:"mobile",phone:void E.trim(),location:void 0},owner:{source:"local"},createdAt:Date.now(),profileProgress:0,lastUpdated:Date.now()};await t.updateLocalProfileData(a.id,s),k({...s,profileId:a.id})}null==j||j(e),setTimeout(()=>{S("/dashboard")},500)}catch(r){W("Failed to process account. Please try again.")}finally{X(!1)}}else W("Please enter your first and last name")},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"First Name *"}),r.jsx("input",{type:"text",value:L,onChange:e=>D(e.target.value),placeholder:"John",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Last Name *"}),r.jsx("input",{type:"text",value:A,onChange:e=>O(e.target.value),placeholder:"Doe",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email (optional)"}),r.jsx("input",{type:"email",value:E,onChange:e=>T(e.target.value),placeholder:"john@example.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),!z&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"4-Digit PIN *"}),r.jsx("input",{type:"password",value:F,onChange:e=>G(e.target.value.slice(0,4)),placeholder:"••••",maxLength:4,pattern:"[0-9]{4}",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-center text-2xl focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0}),r.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"You'll use this to secure your local account"})]}),z&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password (min 8 characters) *"}),r.jsx("input",{type:"password",value:B,onChange:e=>U(e.target.value),placeholder:"Enter password",minLength:8,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),r.jsx("div",{children:r.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:z,onChange:e=>{q(e.target.checked),G(""),U("")},className:"w-4 h-4 rounded border-gray-300"}),"Use password instead of PIN"]})}),Y&&r.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:Y})}),r.jsx("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg",children:r.jsxs("p",{className:"text-xs text-purple-900 dark:text-purple-100",children:["🔐 ",r.jsx("strong",{children:"Secure Local Access"})," Your account data is stored securely on this device. If you already have an account with this name, you'll sign in. Otherwise, a new account will be created."]})}),r.jsx("button",{type:"submit",disabled:K||!L.trim()||!A.trim()||!z&&F.length<4||z&&B.length<8,className:"w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold rounded-lg transition-colors",children:K?"Processing...":"Continue"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"By continuing, you agree to our Terms of Service and Privacy Policy"})]})]}),le&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full mx-4",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"text-6xl mb-4",children:"📁"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Connect Google Drive"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Sign in to Google Drive to import your LifeSync profile"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("button",{onClick:async()=>{try{await u.signIn(),te(!0),ie(!1),await loadGoogleDriveFiles()}catch(e){W("Google Drive sign-in failed: "+e.message)}},disabled:K,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-semibold rounded-lg transition-colors",children:[r.jsx("span",{children:"📁"}),K?"Connecting...":"Continue with Google Drive"]}),r.jsx("button",{onClick:()=>ie(!1),className:"w-full px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm",children:"Cancel"})]}),Y&&r.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:Y})})]})}),re&&ae.length>0&&!de&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"text-6xl mb-4",children:"📄"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Select Profile File"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Choose a LifeSync profile file from your Google Drive"})]}),r.jsx("div",{className:"space-y-3 mb-6",children:ae.map(e=>r.jsxs("button",{onClick:()=>(async e=>{oe(e)})(e),className:"w-full p-4 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),r.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Modified: ",new Date(e.modifiedTime).toLocaleString()]}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Size: ",e.size?`${Math.round(parseInt(e.size)/1024)} KB`:"Unknown"]})]},e.id))}),r.jsx("button",{onClick:()=>{te(!1),se([]),ie(!1)},className:"w-full px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 text-sm",children:"Cancel"})]})}),de&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full mx-4",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"text-6xl mb-4",children:"🔐"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Enter Password"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Enter the password used to encrypt this profile"})]}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),(async()=>{if(de&&ne){X(!0);try{const e=await u.downloadFile(de.id);await h(e,ne),S("/dashboard")}catch(e){W("Import failed: "+e.message)}finally{X(!1)}}else W("Please select a file and enter the password")})()},className:"space-y-4",children:[r.jsx("div",{children:r.jsx("input",{type:"password",value:ne,onChange:e=>ce(e.target.value),placeholder:"Enter decryption password",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent dark:bg-gray-700 dark:text-white",required:!0})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{type:"submit",disabled:K||!ne,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-semibold rounded-lg transition-colors",children:K?"Importing...":"Import Profile"}),r.jsx("button",{type:"button",onClick:()=>{oe(null),ce("")},className:"px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Back"})]})]}),Y&&r.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:r.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:Y})})]})})]})};export{GuestLoginPage,GuestLoginPage as default};
