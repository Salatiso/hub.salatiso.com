import{j as e,G as t}from"./index-cd94da5a.js";import{r as a,e as s}from"./vendor-d6555781.js";import{g as r,I as i,aD as l,D as n,z as d,A as c,a8 as o,b as m,G as x}from"./ui-eef567c7.js";const FacialRecognition=({onCapture:t,userType:m="participant",className:x="",context:u="lifesync"})=>{const[h,g]=a.useState(!1),[b,f]=a.useState(null),[j,y]=a.useState(!1),[N,p]=a.useState(null),[v,w]=a.useState(null),[k,C]=a.useState(!1),S=a.useRef(null),V=a.useRef(null),I=a.useRef(null),D=a.useCallback(async()=>{try{w(null);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});S.current&&(S.current.srcObject=e,I.current=e,C(!0))}catch(e){w("Camera access denied or unavailable")}},[]),T=a.useCallback(()=>{I.current&&(I.current.getTracks().forEach(e=>e.stop()),I.current=null),S.current&&(S.current.srcObject=null),C(!1)},[]),F=a.useCallback(()=>{if(!S.current||!V.current)return;g(!0),w(null);const e=S.current,a=V.current,s=a.getContext("2d");a.width=e.videoWidth,a.height=e.videoHeight,s.drawImage(e,0,0,a.width,a.height),a.toBlob(async e=>{if(e){const a=URL.createObjectURL(e);f(a),y(!0),setTimeout(()=>{const s={isValid:!0,confidence:.92,livenessVerified:!0,faceDetected:!0};p(s),y(!1),g(!1),t&&t({imageBlob:e,imageUrl:a,validation:s,timestamp:(new Date).toISOString(),userType:m,context:u})},2e3)}else w("Failed to capture photo"),g(!1)},"image/jpeg",.8)},[t,m,u]),P=a.useCallback(()=>{f(null),p(null),w(null)},[]),A=a.useCallback(()=>{T(),f(null),p(null),w(null),g(!1),y(!1)},[T]);return s.useEffect(()=>()=>{T()},[T]),e.jsx("div",{className:`facial-recognition ${x}`,children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center mb-3",children:[e.jsx(r,{className:"w-8 h-8 text-blue-600 mr-2"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Facial Verification"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please ensure good lighting and remove glasses/sunglasses"})]}),!k&&!b&&e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-32 h-32 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(i,{className:"w-12 h-12 text-gray-400"})}),e.jsx("button",{onClick:D,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Enable Camera"})]}),k&&!b&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("video",{ref:S,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full rounded-lg border-2 border-gray-200",style:{maxHeight:"300px"}}),e.jsx("canvas",{ref:V,className:"hidden"})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("button",{onClick:F,disabled:h,className:"bg-green-600 text-white px-8 py-3 rounded-full hover:bg-green-700 transition-colors disabled:opacity-50",children:h?e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"w-5 h-5 mr-2 animate-spin"}),"Capturing..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2"}),"Take Photo"]})})})]}),b&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:b,alt:"Captured",className:"w-full rounded-lg border-2 border-gray-200"}),N&&e.jsx("div",{className:"absolute top-2 right-2",children:N.isValid?e.jsx(n,{className:"w-8 h-8 text-green-500 bg-white rounded-full"}):e.jsx(d,{className:"w-8 h-8 text-red-500 bg-white rounded-full"})})]}),j&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(l,{className:"w-5 h-5 mr-2 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-600",children:"Validating..."})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse",style:{width:"60%"}})})]}),N&&!j&&e.jsx("div",{className:"mt-4",children:N.isValid?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(n,{className:"w-5 h-5 text-green-600 mr-2"}),e.jsx("span",{className:"font-medium text-green-800",children:"Verification Successful"})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("p",{children:"Face detected: ✓"}),e.jsx("p",{children:"Liveness verified: ✓"}),e.jsxs("p",{children:["Confidence: ",(100*N.confidence).toFixed(1),"%"]})]})]}):e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(d,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("span",{className:"font-medium text-red-800",children:"Verification Failed"})]}),e.jsx("p",{className:"text-sm text-red-700",children:"Please ensure your face is clearly visible and try again."})]})}),e.jsxs("div",{className:"mt-4 flex justify-center gap-3",children:[e.jsx("button",{onClick:P,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Retake"}),e.jsx("button",{onClick:A,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Start Over"})]})]}),v&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Error"})]}),e.jsx("p",{className:"text-red-700 mt-1",children:v})]})}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx(o,{className:"w-4 h-4 inline mr-1"}),"Look directly at the camera"]}),e.jsx("p",{children:"Ensure good lighting and remove obstructions"})]})]})})},IDVerification=({onVerificationComplete:s,context:r="general",requireFacial:l=!0,requireNationality:d=!1,className:o=""})=>{var u;const{guestData:h,setGuestData:g}=a.useContext(t),[b,f]=a.useState(1),[j,y]=a.useState(!1),[N,p]=a.useState({idNumber:"",idType:"south-african",nationality:"",workPermit:"",facialVerified:!1,idVerified:!1,nationalityConfirmed:!1}),[v,w]=a.useState(null),[k,C]=a.useState(!1),calculateTrustScore=()=>{let e=0;return N.idVerified&&(e+=40),N.facialVerified&&(e+=35),N.nationalityConfirmed&&(e+=25),Math.min(e,100)};return e.jsxs("div",{className:`max-w-2xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 ${o}`,children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(m,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Identity Verification"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Complete verification to enhance trust and safety"})]}),e.jsx("div",{className:"flex items-center justify-center mb-8",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(b>=t?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:t}),t<4&&e.jsx("div",{className:"w-12 h-0.5 mx-2 "+(b>t?"bg-blue-600":"bg-gray-200")})]},t))}),1===b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ID Type"}),e.jsx("select",{value:N.idType,onChange:e=>p(t=>({...t,idType:e.target.value})),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[{value:"south-african",label:"South African ID"},{value:"passport",label:"Passport"},{value:"drivers-license",label:"Driver's License"},{value:"work-permit",label:"Work Permit"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ID Number"}),e.jsx("input",{type:"text",value:N.idNumber,onChange:e=>p(t=>({...t,idNumber:e.target.value})),placeholder:"south-african"===N.idType?"e.g., 8001015009087":"Enter ID number",className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",maxLength:"south-african"===N.idType?13:20})]}),e.jsx("button",{onClick:()=>{y(!0),setTimeout(()=>{if("south-african"===N.idType){const e=(e=>{if(!/^\d{13}$/.test(e))return{valid:!1,errors:[{message:"ID must be exactly 13 digits"}]};const t=parseInt(e.substring(0,2)),a=parseInt(e.substring(2,4)),s=parseInt(e.substring(4,6)),r=parseInt(e.substring(6,10))<5e3?"Female":"Male",i=0===parseInt(e.substring(10,11))?"South African":"Permanent Resident",l=t>(new Date).getFullYear()%100?1900+t:2e3+t;if(a<1||a>12)return{valid:!1,errors:[{message:"Invalid birth month"}]};if(s<1||s>31)return{valid:!1,errors:[{message:"Invalid birth day"}]};let n=0;for(let o=0;o<12;o++){let t=parseInt(e[o]);o%2==0&&(t*=2,t>9&&(t-=9)),n+=t}const d=(10-n%10)%10===parseInt(e[12]),c=(new Date).getFullYear()-l;return{valid:d,dateOfBirth:`${s.toString().padStart(2,"0")}/${a.toString().padStart(2,"0")}/${l}`,age:c,gender:r,citizenship:i,checksumValid:d}})(N.idNumber);w(e),e.valid&&(p(e=>({...e,idVerified:!0})),f(2))}else{const e={valid:N.idNumber.length>=5,message:N.idNumber.length>=5?"ID format accepted":"ID too short"};w(e),e.valid&&(p(e=>({...e,idVerified:!0})),f(2))}y(!1)},1500)},disabled:!N.idNumber.trim()||j,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-colors",children:j?"Validating...":"Validate ID"}),v&&e.jsx("div",{className:"mt-4 p-4 rounded-lg border",children:v.valid?e.jsxs("div",{className:"text-green-600 dark:text-green-400",children:[e.jsx(n,{className:"w-5 h-5 inline mr-2"}),e.jsx("span",{className:"font-semibold",children:"ID Validated Successfully"}),v.dateOfBirth&&e.jsxs("div",{className:"text-sm mt-2 space-y-1",children:[e.jsxs("div",{children:["DOB: ",v.dateOfBirth]}),e.jsxs("div",{children:["Age: ",v.age]}),e.jsxs("div",{children:["Gender: ",v.gender]})]})]}):e.jsxs("div",{className:"text-red-600 dark:text-red-400",children:[e.jsx(c,{className:"w-5 h-5 inline mr-2"}),e.jsx("span",{className:"font-semibold",children:"Validation Failed"}),e.jsx("ul",{className:"text-sm mt-2 list-disc list-inside",children:null==(u=v.errors)?void 0:u.map((t,a)=>e.jsx("li",{children:t.message},a))})]})})]}),2===b&&l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(i,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Facial Verification"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Take a photo to verify your identity"})]}),k?e.jsx(FacialRecognition,{onCapture:()=>{p(e=>({...e,facialVerified:!0})),C(!1),f(d?3:4)},userType:"verifier",context:r}):e.jsx("button",{onClick:()=>C(!0),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Start Facial Verification"})]}),3===b&&d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Nationality & Work Status"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Confirm your nationality and work authorization"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nationality"}),e.jsxs("select",{value:N.nationality,onChange:e=>p(t=>({...t,nationality:e.target.value})),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select nationality"}),["South African","Zimbabwean","Mozambican","Botswanan","Namibian","Lesotho","Swazi","Malawian","Zambian","Angolan","Other"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),N.nationality&&"South African"!==N.nationality&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Work Permit Number"}),e.jsx("input",{type:"text",value:N.workPermit,onChange:e=>p(t=>({...t,workPermit:e.target.value})),placeholder:"Enter work permit number",className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Required for non-South African citizens working in South Africa"})]}),e.jsx("button",{onClick:()=>{N.nationality&&("South African"===N.nationality||N.workPermit)&&(p(e=>({...e,nationalityConfirmed:!0})),f(4))},disabled:!N.nationality||"South African"!==N.nationality&&!N.workPermit,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Confirm Nationality"})]}),4===b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(n,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Verification Complete"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Your identity has been verified successfully"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"Verification Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ID Verification:"}),e.jsx("span",{className:N.idVerified?"text-green-600":"text-red-600",children:N.idVerified?"✓ Verified":"✗ Not Verified"})]}),l&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Facial Verification:"}),e.jsx("span",{className:N.facialVerified?"text-green-600":"text-red-600",children:N.facialVerified?"✓ Verified":"✗ Not Verified"})]}),d&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Nationality Confirmed:"}),e.jsx("span",{className:N.nationalityConfirmed?"text-green-600":"text-red-600",children:N.nationalityConfirmed?"✓ Confirmed":"✗ Not Confirmed"})]}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Trust Score:"}),e.jsxs("span",{className:"text-blue-600",children:[calculateTrustScore(),"%"]})]})]})]}),e.jsx("button",{onClick:()=>{const e={...N,verifiedAt:Date.now(),context:r,trustScore:calculateTrustScore()},t={...h,verifications:[...h.verifications||[],e],trustScore:Math.max(h.trustScore||0,e.trustScore)};g(t),s&&s(e)},className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Complete Verification"})]})]})};export{FacialRecognition as F,IDVerification as I};
