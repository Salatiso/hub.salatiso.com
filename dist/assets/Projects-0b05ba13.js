import{j as e,G as s,x as r,y as a}from"./index-0094ed61.js";import{r as t}from"./vendor-ea3cc270.js";import{x as l,m as n,p as o,u as i,I as c}from"./firebase-147eafc7.js";import{z as d,r as u,j as p,a6 as g,U as x,u as m,Z as b,v as h,A as j,X as y}from"./ui-a8f8a709.js";import{a as f,b as N,c as v}from"./layoutHelpers-b7eca1f0.js";import"./i18n-80c88d68.js";const w=t.memo(function({project:s,statusColors:r,priorityColors:a,onEdit:t,onDelete:l}){return e.jsxs("div",{className:`rounded-lg p-6 hover:shadow-md transition-shadow ${r[s.status]||r.planned}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r[s.status]||r.planned}`,children:s.status.replace(/([A-Z])/g," $1").trim()}),s.priority&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a[s.priority]}`,children:s.priority.charAt(0).toUpperCase()+s.priority.slice(1)})]}),s.description&&e.jsx("p",{className:"text-gray-700 mb-2",children:s.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t(s),className:"p-2 text-blue-600 hover:bg-blue-200 rounded-lg","aria-label":`Edit project: ${s.name}`,children:e.jsx(d,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(s.id),className:"p-2 text-red-600 hover:bg-red-200 rounded-lg","aria-label":`Delete project: ${s.name}`,children:e.jsx(u,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progress"}),e.jsxs("span",{className:"text-sm font-bold",children:[s.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-300 bg-opacity-30 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${s.progress}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsxs("span",{children:["Start: ",s.startDate]})]}),s.endDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsxs("span",{children:["End: ",s.endDate]})]}),s.team&&e.jsxs("div",{className:"col-span-2 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsxs("span",{className:"truncate",children:["Team: ",s.team]})]})]})]},s.id)});function Projects(){const{guestData:d,updateGuestData:u}=t.useContext(s),{user:p}=r(),[g,x]=t.useState((null==d?void 0:d.projects)||[]),[C,P]=t.useState(!1),[D,S]=t.useState(null),[A,k]=t.useState("idle"),[U,$]=t.useState(null),[E,I]=t.useState("all"),[H,M]=t.useState({name:"",description:"",status:"planned",startDate:"",endDate:"",progress:0,team:"",priority:"medium",category:"other"});t.useEffect(()=>{if(!p)return;(async()=>{try{k("syncing");const e=n(a,"users",p.uid,"projects","all"),s=await o(e);if(s.exists()){const e=s.data();x(e.projects||[]),$(e.lastUpdatedAt)}k("success")}catch(e){k("error")}})();return l(n(a,"users",p.uid,"projects","all"),e=>{if(e.exists()){const s=e.data();x(s.projects||[]),$(s.lastUpdatedAt)}},e=>{})},[p]);const saveProjects=e=>{x(e),u(s=>({...s,projects:e})),(async e=>{if(p)try{k("syncing");const s=n(a,"users",p.uid,"projects","all");await i(s,{projects:e,lastUpdatedBy:"lifesync",lastUpdatedAt:c()}),$(new Date),k("success")}catch(s){k("error")}})(e)},T=t.useCallback(()=>{if(H.name){if(D){const e=g.map(e=>e.id===D.id?{...D,...H,progress:parseInt(H.progress),updatedAt:(new Date).toISOString()}:e);saveProjects(e),S(null)}else{const e={id:Date.now(),...H,progress:parseInt(H.progress),createdAt:(new Date).toISOString()};saveProjects([...g,e])}M({name:"",description:"",status:"planned",startDate:"",endDate:"",progress:0,team:"",priority:"medium",category:"other"}),P(!1)}else alert("Please enter a project name")},[H,D,g]),L=t.useCallback(e=>{S(e),M(e),P(!0)},[]),O=t.useCallback(e=>{confirm("Delete this project?")&&saveProjects(g.filter(s=>s.id!==e))},[g]),Z={planned:"bg-gray-100 text-gray-800 border-l-4 border-gray-500",inProgress:"bg-blue-100 text-blue-800 border-l-4 border-blue-500",completed:"bg-green-100 text-green-800 border-l-4 border-green-500",onHold:"bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500",cancelled:"bg-red-100 text-red-800 border-l-4 border-red-500"},G={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"},z=t.useMemo(()=>"all"===E?g:g.filter(e=>e.status===E),[E,g]),B=t.useMemo(()=>g.filter(e=>"completed"===e.status).length,[g]),F=t.useMemo(()=>g.filter(e=>"inProgress"===e.status).length,[g]),q=t.useMemo(()=>g.length>0?Math.round(g.reduce((e,s)=>e+s.progress,0)/g.length):0,[g]);return e.jsxs("div",{className:f(),children:[e.jsxs("div",{className:N(),children:[e.jsxs("div",{children:[e.jsx("h1",{className:v(),children:"Projects"}),U&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Last synced: ",new Date(U).toLocaleTimeString()]})]}),e.jsxs("button",{onClick:()=>{P(!C),S(null)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors","aria-label":"Add new project",children:[e.jsx(m,{className:"w-4 h-4"}),"New Project"]})]}),"idle"!==A&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2 "+("success"===A?"bg-green-50 text-green-700":"error"===A?"bg-red-50 text-red-700":"bg-blue-50 text-blue-700"),children:["syncing"===A&&e.jsx(b,{className:"w-4 h-4 animate-spin"}),"success"===A&&e.jsx(h,{className:"w-4 h-4"}),"error"===A&&e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"syncing"===A?"Syncing with Firebase...":"success"===A?"Synced successfully!":"Sync error - changes saved locally"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Projects"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:g.length})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:B})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:F})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Avg Progress"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[q,"%"]})]})]}),C&&e.jsxs("div",{className:"bg-blue-50 rounded-lg border-2 border-blue-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:D?"Edit Project":"Create New Project"}),e.jsx("button",{onClick:()=>{P(!1),S(null)},"aria-label":"Close form",children:e.jsx(y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Project Name *",value:H.name,onChange:e=>M({...H,name:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Project name"}),e.jsxs("select",{value:H.status,onChange:e=>M({...H,status:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Project status",children:[e.jsx("option",{value:"planned",children:"Planned"}),e.jsx("option",{value:"inProgress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"onHold",children:"On Hold"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:H.priority,onChange:e=>M({...H,priority:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Project priority",children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"}),e.jsx("option",{value:"critical",children:"Critical"})]}),e.jsx("input",{type:"number",placeholder:"Progress (%)",min:"0",max:"100",value:H.progress,onChange:e=>M({...H,progress:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Progress percentage"}),e.jsx("input",{type:"date",value:H.startDate,onChange:e=>M({...H,startDate:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Start date"}),e.jsx("input",{type:"date",value:H.endDate,onChange:e=>M({...H,endDate:e.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"End date"}),e.jsx("input",{type:"text",placeholder:"Team (comma-separated)",value:H.team,onChange:e=>M({...H,team:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Team members"}),e.jsx("textarea",{placeholder:"Description",value:H.description,onChange:e=>M({...H,description:e.target.value}),className:"col-span-2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,"aria-label":"Project description"})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-4",children:[e.jsx("button",{onClick:()=>{P(!1),S(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50","aria-label":"Cancel",children:"Cancel"}),e.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700","aria-label":D?"Update project":"Create project",children:[e.jsx(m,{className:"w-4 h-4"}),D?"Update":"Create"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","planned","inProgress","completed","onHold","cancelled"].map(s=>e.jsx("button",{onClick:()=>I(s),className:"px-4 py-2 rounded-lg whitespace-nowrap transition-colors "+(E===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),"aria-pressed":E===s,children:"all"===s?"All":s.replace(/([A-Z])/g," $1").trim()},s))}),0===z.length?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center text-gray-500",children:["No projects in this status. ",e.jsx("button",{onClick:()=>{P(!0),S(null)},className:"text-blue-600 underline",children:"Create one!"})]}):e.jsx("div",{className:"space-y-4",children:z.map(s=>e.jsx(w,{project:s,statusColors:Z,priorityColors:G,onEdit:L,onDelete:O},s.id))})]})}export{Projects as default};
