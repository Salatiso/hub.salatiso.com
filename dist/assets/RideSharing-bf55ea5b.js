import{j as e}from"./index-cd94da5a.js";import{r,L as t}from"./vendor-d6555781.js";import{u as a}from"./i18n-8b62e3c8.js";import{at as s,E as i,A as l,ab as n,p as d,a0 as c,i as o,au as x,X as m,t as g,s as h,D as u,J as p,b as y,av as b,U as v,n as f,as as j,ac as N,O as k,aw as w,ax as S}from"./ui-eef567c7.js";import"./firebase-fb364782.js";const RideSharing=()=>{var R,M,C,T,I;const[P,D]=r.useState("find-ride"),[L,O]=r.useState(null),[A,_]=r.useState(null),[B,$]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_active_ride")||"null")}catch{return null}}),[E,F]=r.useState(!1),[G,J]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_ride_sync_config")||"null")}catch{return null}}),[U]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_ride_group_members")||"[]")}catch{return[]}}),[V,W]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_feedback_reports")||"[]")}catch{return[]}}),[Z,z]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_escalation_status")||'{"stage":"idle","lastNotifiedAt":null}')}catch{return{stage:"idle",lastNotifiedAt:null}}}),[H,Q]=r.useState(Date.now()),[Y,q]=r.useState(0),[K,X]=r.useState([]),[ee,re]=r.useState([]),[te,ae]=r.useState("idle"),[se,ie]=r.useState(!1),[le,ne]=r.useState(()=>{try{return JSON.parse(localStorage.getItem("lifesync_personal_sync"))||{enabled:!1,serviceType:"none",vehicleType:"sedan",capacity:5,seats:[],additionalPassengers:0,mySeatId:null,speedMonitoring:{enabled:!1,share:!1,intervalSec:60,saveLog:!0},seatsGrid:[],conduct:{reckless:!1,fatigueObserved:!1,notes:""}}}catch{return{enabled:!1,serviceType:"none",vehicleType:"sedan",capacity:5,seats:[],additionalPassengers:0,mySeatId:null,speedMonitoring:{enabled:!1,share:!1,intervalSec:60,saveLog:!0},seatsGrid:[],conduct:{reckless:!1,fatigueObserved:!1,notes:""}}}}),de=r.useRef(null),ce=r.useRef(null),oe=r.useRef(null),xe=r.useRef(null),me=r.useRef(null),ge=r.useRef({p2p:null,internet:null});a();const[he]=r.useState([{id:1,driver:{name:"Thabo Mthembu",rating:4.8,profileImage:"/api/placeholder/40/40",verified:!0,safetyScore:95,completedRides:342,emergencyContacts:["+27123456789","+27876543210"]},vehicle:{make:"Toyota",model:"Corolla",year:2020,color:"Silver",licensePlate:"CA 123-456",seats:4,lifesyncSeal:!0,professionalUse:!1},route:{from:"Sandton City Mall",to:"OR Tambo International Airport",distance:"28 km",duration:"35 min",departureTime:"2025-09-04T15:30:00Z",waypoints:["Midrand","Kempton Park"]},pricing:{total:180,perSeat:45,currency:"ZAR"},availableSeats:3,safetyFeatures:["GPS Tracking","Emergency Button","Identity Verified","Insurance Covered","Group Sync","Proximity Alerts","Auto-Escalation"],preferences:["No Smoking","Music OK","Conversation Welcome"],syncSettings:{groupSync:!0,emergencyContactAccess:"basic",locationSharing:"trip-duration",dataRetention:"trip-only",syncMethod:"bluetooth+wifi"},passengerAgreements:{termsAccepted:!1,dataShared:"minimum"}},{id:2,driver:{name:"Sarah Johnson",rating:4.9,profileImage:"/api/placeholder/40/40",verified:!0,safetyScore:98,completedRides:567},vehicle:{make:"Honda",model:"Civic",year:2019,color:"Blue",licensePlate:"GP 789-012",seats:4},route:{from:"Rosebank",to:"Pretoria CBD",distance:"65 km",duration:"1h 15min",departureTime:"2025-09-04T16:00:00Z"},pricing:{total:320,perSeat:80,currency:"ZAR"},availableSeats:2,safetyFeatures:["GPS Tracking","Emergency Button","Identity Verified","Insurance Covered"],preferences:["No Smoking","Quiet Ride","Professional"]}]),[ue]=r.useState([{id:"ride-001",status:"upcoming",driver:"Thabo Mthembu",from:"Home",to:"University of Witwatersrand",departureTime:"2025-09-05T07:30:00Z",price:35,passengerCount:1},{id:"ride-002",status:"completed",driver:"Maria Santos",from:"Mall of Africa",to:"Home",departureTime:"2025-09-03T18:45:00Z",price:42,rating:5,passengerCount:1}]);r.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{O({lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy})},e=>{})},[]),r.useEffect(()=>{G&&localStorage.setItem("lifesync_ride_sync_config",JSON.stringify(G))},[G]),r.useEffect(()=>{localStorage.setItem("lifesync_ride_group_members",JSON.stringify(U))},[U]),r.useEffect(()=>{localStorage.setItem("lifesync_feedback_reports",JSON.stringify(V))},[V]),r.useEffect(()=>{localStorage.setItem("lifesync_escalation_status",JSON.stringify(Z))},[Z]),r.useEffect(()=>{localStorage.setItem("lifesync_personal_sync",JSON.stringify(le))},[le]);const haversine=(e,r)=>{if(!e||!r)return 1/0;const toRad=e=>e*Math.PI/180,t=toRad(r.lat-e.lat),a=toRad(r.lng-e.lng),s=toRad(e.lat),i=toRad(r.lat),l=Math.sin(t/2),n=Math.sin(a/2);return 6371e3*(2*Math.asin(Math.sqrt(l*l+Math.cos(s)*Math.cos(i)*n*n)))},stopTracking=()=>{de.current&&navigator.geolocation&&(navigator.geolocation.clearWatch(de.current),de.current=null),ce.current&&(clearInterval(ce.current),ce.current=null),oe.current&&(clearInterval(oe.current),oe.current=null),me.current&&(clearInterval(me.current),me.current=null)};r.useEffect(()=>()=>stopTracking(),[]);const handleGroupSync=e=>{e.id,e.passengers,e.syncSettings.groupSync,e.syncSettings.syncMethod},startTripWithConfig=(e,r)=>{ie(!0),$(e),localStorage.setItem("lifesync_active_ride",JSON.stringify(e)),D("active-ride"),J(r),q(0),z({stage:"started",lastNotifiedAt:(new Date).toISOString()}),Q(Date.now()),(e=>{var r;if(navigator.geolocation&&!de.current&&(de.current=navigator.geolocation.watchPosition(e=>{var r;const t={lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy};if((!L||haversine(L,t)>15)&&Q(Date.now()),O(t),null==(r=null==le?void 0:le.speedMonitoring)?void 0:r.enabled){const e=Date.now();if(xe.current){const r=(e-xe.current.t)/1e3,a=haversine(xe.current.loc,t),s=r>0?a/r:0,i=Math.round(3.6*s*10)/10,l={t:new Date(e).toISOString(),lat:t.lat,lng:t.lng,kmh:i};le.speedMonitoring.saveLog&&re(e=>[...e.slice(-199),l])}xe.current={loc:t,t:e}}},e=>{},{enableHighAccuracy:!0,maximumAge:1e4})),ce.current||(ce.current=setInterval(()=>{const r=(Date.now()-H)/6e4,t=(null==e?void 0:e.stopThresholdMin)??10;r>=t&&Y<2?(q(e=>e+1),z({stage:`reminder-${Y+1}`,lastNotifiedAt:(new Date).toISOString()})):r>=t+5&&Y>=2&&"escalated"!==Z.stage&&z({stage:"escalated",lastNotifiedAt:(new Date).toISOString()})},6e4)),oe.current||(oe.current=setInterval(()=>{if("full"===(null==e?void 0:e.groupMode)&&L&&(null==U?void 0:U.length)>0){const r=(null==e?void 0:e.proximityThresholdM)??100,t=[];U.forEach(e=>{if(e.location){const a=haversine(L,e.location);a>r&&t.push({memberId:e.id,name:e.name,distance:Math.round(a)})}}),X(t)}else X([])},6e4)),(null==(r=null==le?void 0:le.speedMonitoring)?void 0:r.enabled)&&!me.current){const e=Math.max(1e4,1e3*(le.speedMonitoring.intervalSec||60));me.current=setInterval(()=>{const e=Date.now();if(xe.current&&L){const r=(e-xe.current.t)/1e3,t=haversine(xe.current.loc,L),a=r>0?t/r:0,s=Math.round(3.6*a*10)/10,i={t:new Date(e).toISOString(),lat:L.lat,lng:L.lng,kmh:s,aggregated:!0};le.speedMonitoring.saveLog&&re(e=>[...e.slice(-199),i])}},e)}})(r);try{ye.start(r)}catch(t){}setTimeout(()=>ie(!1),1e3)},pe={role:"passenger",shareLevel:"minimum",groupMode:"driver-only",stopThresholdMin:10,proximityThresholdM:100,feedbackThreshold:.5,contacts:[],connectivity:{preferred:"p2p",p2p:{bluetooth:!0,wifiDirect:!0,intervalSec:60},internet:{enabled:!0,intervalSec:120}}},ye={start(e){var r,t,a,s,i;this.stop(),ae("connecting");const l=(null==e?void 0:e.connectivity)||pe.connectivity,n=l.preferred,d=1e3*(null==(r=l.p2p)?void 0:r.intervalSec)||6e4,c=1e3*(null==(t=l.internet)?void 0:t.intervalSec)||12e4;"p2p"===n&&((null==(a=l.p2p)?void 0:a.bluetooth)||(null==(s=l.p2p)?void 0:s.wifiDirect))?ge.current.p2p=setInterval(()=>{this.performP2PSync(e)},d):"internet"===n&&(null==(i=l.internet)?void 0:i.enabled)?ge.current.internet=setInterval(()=>{this.performInternetSync(e)},c):ae("error")},stop(){ge.current.p2p&&(clearInterval(ge.current.p2p),ge.current.p2p=null),ge.current.internet&&(clearInterval(ge.current.internet),ge.current.internet=null),ae("idle")},performP2PSync(e){const r=Math.random()>.1;ae(r?"connected":"error")},performInternetSync(){const e={rideId:null==B?void 0:B.id,location:L,groupMembers:U,feedbackReports:V,timestamp:Date.now()};fetch("https://pigeeback-lifecv.web.app/api/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{e.ok?ae("connected"):ae("error")}).catch(e=>{ae("error")})}},be={sedan:{capacity:5,seats:[[{id:"D",label:"Driver"},{id:"F",label:"Front Passenger"}],[{id:"B1",label:"Back Left"},{id:"B2",label:"Back Middle"},{id:"B3",label:"Back Right"}]]},minibus16:{capacity:16,seats:[[{id:"D",label:"Driver"},{id:"F",label:"Front Passenger"}],[{id:"R1L",label:"Row1-L"},{id:"R1M",label:"Row1-M"},{id:"R1R",label:"Row1-R"}],[{id:"R2L",label:"Row2-L"},{id:"R2M",label:"Row2-M"},{id:"R2R",label:"Row2-R"}],[{id:"R3L",label:"Row3-L"},{id:"R3M",label:"Row3-M"},{id:"R3R",label:"Row3-R"}],[{id:"R4L",label:"Row4-L"},{id:"R4M",label:"Row4-M"},{id:"R4R",label:"Row4-R"}]]},bus:{capacity:40,seats:Array.from({length:10},(e,r)=>[{id:`R${r+1}A`,label:`R${r+1}-A`},{id:`R${r+1}B`,label:`R${r+1}-B`},{id:`R${r+1}C`,label:`R${r+1}-C`},{id:`R${r+1}D`,label:`R${r+1}-D`}])},bakkie:{capacity:5,seats:[[{id:"D",label:"Driver"},{id:"F",label:"Front Passenger"}],[{id:"B1",label:"Back Left"},{id:"B2",label:"Back Middle"},{id:"B3",label:"Back Right"}]]},truck:{capacity:3,seats:[[{id:"D",label:"Driver"},{id:"P1",label:"Passenger 1"},{id:"P2",label:"Passenger 2"}]]},train:{capacity:20,seats:Array.from({length:5},(e,r)=>[{id:`R${r+1}L`,label:`Row${r+1}-L`},{id:`R${r+1}R`,label:`Row${r+1}-R`}])}},buildSeatState=e=>{const r=be[e]||be.sedan,t=r.seats.flat().map(e=>({...e,occupied:!1,synced:!1}));return{capacity:r.capacity,seatsGrid:r.seats,seatsFlat:t}};r.useEffect(()=>{var e;if(!(null==(e=null==le?void 0:le.seats)?void 0:e.length)){const e=buildSeatState(le.vehicleType);ne(r=>({...r,capacity:e.capacity,seats:e.seatsFlat,seatsGrid:e.seatsGrid}))}},[]);const VehicleIconSvg=({type:r,selected:t})=>{const a=t?"#2563eb":"#6b7280",s=t?"#bfdbfe":"none";switch(r){case"sedan":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"6",y:"12",width:"44",height:"12",rx:"4",fill:s,stroke:a}),e.jsx("polygon",{points:"18,12 30,8 44,12",fill:s,stroke:a}),e.jsx("circle",{cx:"18",cy:"26",r:"3",fill:a}),e.jsx("circle",{cx:"44",cy:"26",r:"3",fill:a})]});case"minibus16":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"4",y:"8",width:"52",height:"16",rx:"3",fill:s,stroke:a}),e.jsx("rect",{x:"8",y:"10",width:"10",height:"6",fill:"white",stroke:a}),e.jsx("rect",{x:"20",y:"10",width:"10",height:"6",fill:"white",stroke:a}),e.jsx("rect",{x:"32",y:"10",width:"10",height:"6",fill:"white",stroke:a}),e.jsx("rect",{x:"44",y:"10",width:"10",height:"6",fill:"white",stroke:a}),e.jsx("circle",{cx:"16",cy:"26",r:"3",fill:a}),e.jsx("circle",{cx:"44",cy:"26",r:"3",fill:a})]});case"bus":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"3",y:"7",width:"58",height:"18",rx:"4",fill:s,stroke:a}),e.jsx("rect",{x:"8",y:"10",width:"12",height:"6",fill:"white",stroke:a}),e.jsx("rect",{x:"22",y:"10",width:"12",height:"6",fill:"white",stroke:a}),e.jsx("rect",{x:"36",y:"10",width:"12",height:"6",fill:"white",stroke:a}),e.jsx("circle",{cx:"16",cy:"26",r:"3",fill:a}),e.jsx("circle",{cx:"48",cy:"26",r:"3",fill:a})]});case"bakkie":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"10",y:"14",width:"24",height:"8",fill:s,stroke:a}),e.jsx("rect",{x:"34",y:"12",width:"20",height:"10",fill:s,stroke:a}),e.jsx("circle",{cx:"20",cy:"26",r:"3",fill:a}),e.jsx("circle",{cx:"46",cy:"26",r:"3",fill:a})]});case"truck":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"6",y:"12",width:"30",height:"10",fill:s,stroke:a}),e.jsx("rect",{x:"38",y:"10",width:"20",height:"12",fill:s,stroke:a}),e.jsx("circle",{cx:"16",cy:"26",r:"3",fill:a}),e.jsx("circle",{cx:"44",cy:"26",r:"3",fill:a})]});case"train":return e.jsxs("svg",{width:"64",height:"32",viewBox:"0 0 64 32","aria-hidden":!0,children:[e.jsx("rect",{x:"6",y:"8",width:"52",height:"16",rx:"2",fill:s,stroke:a}),e.jsx("line",{x1:"10",y1:"26",x2:"54",y2:"26",stroke:a})]});default:return null}},SeatMapSvg=({seats:r,seatsGrid:t,mySeatId:a,onToggle:s,onSetMe:i})=>{const l=t.length,n=Math.max(...t.map(e=>e.length)),d=60*n+8*(n-1)+16,c=32*l+8*(l-1)+16,o=r.reduce((e,r)=>(e[r.id]=r,e),{});return e.jsx("svg",{width:d,height:c,role:"img","aria-label":"Seating map",children:t.map((r,t)=>r.map((r,l)=>{const n=8+68*l,d=8+40*t,c=o[r.id]||{occupied:!1},x=a===r.id,m=x?"#bfdbfe":c.occupied?"#dcfce7":"#fff",g=x?"#2563eb":c.occupied?"#16a34a":"#6b7280";return e.jsxs("g",{transform:`translate(${n},${d})`,children:[e.jsx("rect",{width:60,height:32,rx:"6",fill:m,stroke:g}),e.jsx("text",{x:8,y:18,fontSize:"10",fill:"#111827",children:r.label}),x&&e.jsx("text",{x:40,y:12,fontSize:"10",fill:"#2563eb",children:"You"}),e.jsx("rect",{width:60,height:32,rx:"6",fill:"#0000",onClick:()=>s(r.id),onContextMenu:e=>{e.preventDefault(),i(r.id)}})]},r.id)}))})};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(s,{className:"h-12 w-12 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:"Safe Ride Sharing"}),e.jsxs("div",{className:"text-xl text-gray-600 dark:text-gray-400 mt-2",children:[e.jsx("span",{children:"LifeSync Seal Trust & Safety Certified • Powered by "}),e.jsxs("a",{href:"https://pigeeback-lifecv.web.app/",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-700 underline flex items-center space-x-1 inline-flex",children:[e.jsx("span",{children:"Pigeeback"}),e.jsx(i,{className:"h-4 w-4 ml-1"})]})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(t,{to:"/emergency-assistance",className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"Emergency"]}),e.jsx(t,{to:"/control-centre",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",title:"Professional Control Centre",children:"Control Centre"})]})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"find-ride",name:"Find Ride",icon:n},{id:"offer-ride",name:"Offer Ride",icon:d},{id:"personal-sync",name:"Personal Sync",icon:c},{id:"my-rides",name:"My Rides",icon:o},{id:"active-ride",name:"Active Ride",icon:x}].map(r=>e.jsxs("button",{onClick:()=>D(r.id),className:"flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm transition-colors "+(P===r.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(r.icon,{className:"h-4 w-4"}),e.jsx("span",{children:r.name})]},r.id))})})}),"find-ride"===P&&e.jsxs("div",{className:"space-y-6",children:[E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Trip Sync Setup"}),e.jsx("button",{onClick:()=>F(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(m,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mb-4 p-3 rounded bg-blue-50 dark:bg-blue-900/20 text-sm text-blue-800 dark:text-blue-200",children:"You will only receive as much information as you share. Choose your share level and group mode."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Your Role"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.role)||pe.role,onChange:e=>J({...G||pe,role:e.target.value}),children:[e.jsx("option",{value:"passenger",children:"Passenger"}),e.jsx("option",{value:"driver",children:"Driver"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Share Level"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.shareLevel)||pe.shareLevel,onChange:e=>J({...G||pe,shareLevel:e.target.value}),children:[e.jsx("option",{value:"minimum",children:"Minimum (name, contact, live GPS)"}),e.jsx("option",{value:"standard",children:"Standard (adds vehicle/ID partial)"}),e.jsx("option",{value:"full",children:"Full (complete profile)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Group Mode"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.groupMode)||pe.groupMode,onChange:e=>J({...G||pe,groupMode:e.target.value}),children:[e.jsx("option",{value:"driver-only",children:"Driver-only (public transport)"}),e.jsx("option",{value:"full",children:"Full group sync"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stop Threshold (minutes)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.stopThresholdMin)??pe.stopThresholdMin,onChange:e=>J({...G||pe,stopThresholdMin:Number(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Proximity Threshold (meters)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.proximityThresholdM)??pe.proximityThresholdM,onChange:e=>J({...G||pe,proximityThresholdM:Number(e.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Feedback Escalation Threshold"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"1",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==G?void 0:G.feedbackThreshold)??pe.feedbackThreshold,onChange:e=>J({...G||pe,feedbackThreshold:Number(e.target.value)})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:"Emergency Contacts"}),e.jsx("button",{onClick:()=>{return e={name:"Mom",phone:"+27123456789",role:"departure"},void J(r=>({...r,contacts:[...(null==r?void 0:r.contacts)||[],e]}));var e},className:"text-primary-600 hover:underline",children:"+ Quick add example"})]}),e.jsx("div",{className:"mt-2 space-y-2",children:0===((null==G?void 0:G.contacts)||[]).length?e.jsx("div",{className:"text-sm text-gray-500",children:"No contacts yet"}):((null==G?void 0:G.contacts)||[]).map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[r.name," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",r.role,")"]})]}),e.jsx("div",{className:"text-sm text-gray-600",children:r.phone})]}),e.jsx("button",{onClick:()=>J(e=>({...e,contacts:(e.contacts||[]).filter((e,r)=>r!==t)})),className:"text-red-600",children:"Remove"})]},t))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"font-medium mb-2",children:"Connectivity Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Preferred Channel"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==(R=null==G?void 0:G.connectivity)?void 0:R.preferred)||"p2p",onChange:e=>J(r=>({...r||pe,connectivity:{...(null==r?void 0:r.connectivity)||pe.connectivity,preferred:e.target.value}})),children:[e.jsx("option",{value:"p2p",children:"Peer-to-Peer (Bluetooth/WiFi Direct)"}),e.jsx("option",{value:"internet",children:"Internet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"P2P Interval (sec)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==(C=null==(M=null==G?void 0:G.connectivity)?void 0:M.p2p)?void 0:C.intervalSec)??60,onChange:e=>J(r=>{var t;return{...r||pe,connectivity:{...(null==r?void 0:r.connectivity)||pe.connectivity,p2p:{...(null==(t=null==r?void 0:r.connectivity)?void 0:t.p2p)||pe.connectivity.p2p,intervalSec:Math.max(10,Number(e.target.value)||60)}}}})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Lower frequency saves battery"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Internet Interval (sec)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700",value:(null==(I=null==(T=null==G?void 0:G.connectivity)?void 0:T.internet)?void 0:I.intervalSec)??120,onChange:e=>J(r=>{var t;return{...r||pe,connectivity:{...(null==r?void 0:r.connectivity)||pe.connectivity,internet:{...(null==(t=null==r?void 0:r.connectivity)?void 0:t.internet)||pe.connectivity.internet,intervalSec:Math.max(30,Number(e.target.value)||120)}}}})})]})]}),e.jsx("div",{className:"mt-3 text-xs text-gray-500",children:"Bluetooth/WiFi Direct are primary by default; Internet used as fallback or per preference."})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{className:"px-4 py-2 rounded border",onClick:()=>F(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded bg-primary-600 text-white disabled:opacity-50",disabled:se,onClick:()=>{F(!1),startTripWithConfig(A,G||pe)},children:se?"Starting...":"Start Trip"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"Find a Ride"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"From"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Departure location",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Destination",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date & Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"datetime-local",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Passengers"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"1",children:"1 passenger"}),e.jsx("option",{value:"2",children:"2 passengers"}),e.jsx("option",{value:"3",children:"3 passengers"}),e.jsx("option",{value:"4",children:"4 passengers"})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{className:"w-full md:w-auto px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Search Rides"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Available Rides"}),he.map(r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:r.driver.profileImage,alt:r.driver.name,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r.driver.name}),r.driver.verified&&e.jsx(u,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 ml-1",children:r.driver.rating})]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.driver.completedRides," rides"]}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"h-4 w-4 text-green-500 mr-1"}),e.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400",children:[r.driver.safetyScore,"% safety"]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["R",r.pricing.perSeat]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"per seat"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"h-5 w-5 text-primary-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.route.from}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["to ",r.route.to]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-5 w-5 text-primary-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:new Date(r.route.departureTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.route.duration," • ",r.route.distance]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(v,{className:"h-5 w-5 text-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[r.availableSeats," seats available"]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.vehicle.make," ",r.vehicle.model]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Safety Features"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.safetyFeatures.map((r,t)=>e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded dark:bg-green-900 dark:text-green-200",children:r},t))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 text-primary-600 border border-primary-600 rounded hover:bg-primary-50 transition-colors",children:"View Profile"}),e.jsx("button",{className:"px-3 py-1 text-primary-600 border border-primary-600 rounded hover:bg-primary-50 transition-colors",children:"Message"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>handleGroupSync(r),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Group Sync"]}),e.jsxs("button",{onClick:()=>(e=>{_(e),F(!0)})(r),className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Start Safe Ride"]})]})]})]},r.id))]})]}),"offer-ride"===P&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"Offer a Ride"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Departure Location"}),e.jsx("input",{type:"text",placeholder:"Where are you leaving from?",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Destination"}),e.jsx("input",{type:"text",placeholder:"Where are you going?",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Departure Time"}),e.jsx("input",{type:"datetime-local",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Available Seats"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"1",children:"1 seat"}),e.jsx("option",{value:"2",children:"2 seats"}),e.jsx("option",{value:"3",children:"3 seats"}),e.jsx("option",{value:"4",children:"4 seats"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Price per Seat (ZAR)"}),e.jsx("input",{type:"number",placeholder:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Vehicle Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Make & Model"}),e.jsx("input",{type:"text",placeholder:"e.g., Toyota Corolla",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Color"}),e.jsx("input",{type:"text",placeholder:"Vehicle color",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"License Plate"}),e.jsx("input",{type:"text",placeholder:"ABC 123-456",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Safety & Preferences"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Enable GPS tracking during ride"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Allow emergency contacts to track ride"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"No smoking"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Music allowed"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{className:"px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Publish Ride"})})]})}),"personal-sync"===P&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"Create Personal Sync"}),e.jsx("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"none",label:"No Registered Service"},{key:"pigeeback",label:"Pigeeback Service"},{key:"professional",label:"Professional (Taxi/Bus/Train)"}].map(r=>e.jsxs("button",{onClick:()=>ne(e=>({...e,serviceType:r.key,enabled:!0})),className:"p-4 rounded-lg border transition-colors "+(le.serviceType===r.key?"border-primary-600 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-700"),children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-600",children:"pigeeback"===r.key?"Powered by Pigeeback principles":"Local personal sync"})]},r.key))}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"font-medium mb-2",children:"Select Vehicle Type"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[{key:"sedan",label:"Sedan"},{key:"minibus16",label:"Minibus Taxi"},{key:"bus",label:"Bus"},{key:"bakkie",label:"Bakkie"},{key:"truck",label:"Truck"},{key:"train",label:"Train"}].map(r=>e.jsxs("button",{onClick:()=>{const e=buildSeatState(r.key);ne(t=>({...t,vehicleType:r.key,capacity:e.capacity,seats:e.seatsFlat,seatsGrid:e.seatsGrid}))},className:"p-3 rounded border text-sm flex flex-col items-center gap-2 "+(le.vehicleType===r.key?"border-primary-600 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-700"),children:[e.jsx(VehicleIconSvg,{type:r.key,selected:le.vehicleType===r.key}),e.jsx("div",{children:r.label})]},r.key))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-medium mb-2",children:"Seating Map"}),e.jsxs("div",{className:"inline-block p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Left click: toggle occupied • Right click: set your seat"}),e.jsx(SeatMapSvg,{seats:le.seats,seatsGrid:le.seatsGrid.length?le.seatsGrid:buildSeatState(le.vehicleType).seatsGrid,mySeatId:le.mySeatId,onToggle:e=>ne(r=>({...r,seats:r.seats.map(r=>r.id===e?{...r,occupied:!r.occupied}:r)})),onSetMe:e=>ne(r=>({...r,mySeatId:e}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-3 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"text-sm",children:"Vehicle Capacity"}),e.jsx("div",{className:"text-xl font-semibold",children:le.capacity})]}),e.jsxs("div",{className:"p-3 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"text-sm",children:"Occupied Seats"}),e.jsx("div",{className:"text-xl font-semibold",children:le.seats.filter(e=>e.occupied).length})]}),e.jsxs("div",{className:"p-3 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"text-sm mb-1",children:"Additional Passengers (standing/aisles)"}),e.jsx("input",{type:"number",value:le.additionalPassengers,onChange:e=>ne(r=>({...r,additionalPassengers:Math.max(0,Number(e.target.value)||0)})),className:"w-full px-2 py-1 rounded border dark:bg-gray-700"})]})]}),le.seats.filter(e=>e.occupied).length+(le.additionalPassengers||0)>le.capacity&&e.jsx("div",{className:"mb-4 p-3 rounded border border-yellow-300 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-700 text-sm",children:"Soft warning: Occupancy exceeds recorded capacity. Consider safety risks and legal limits."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-medium mb-2",children:"Speed Monitoring (optional)"}),e.jsxs("label",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:le.speedMonitoring.enabled,onChange:e=>ne(r=>({...r,speedMonitoring:{...r.speedMonitoring,enabled:e.target.checked}}))}),e.jsx("span",{children:"Enable speed monitoring"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Log Interval (sec)"}),e.jsx("input",{type:"number",value:le.speedMonitoring.intervalSec,onChange:e=>ne(r=>({...r,speedMonitoring:{...r.speedMonitoring,intervalSec:Math.max(10,Number(e.target.value)||60)}})),className:"w-full px-2 py-1 rounded border dark:bg-gray-700"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:le.speedMonitoring.saveLog,onChange:e=>ne(r=>({...r,speedMonitoring:{...r.speedMonitoring,saveLog:e.target.checked}}))}),e.jsx("span",{children:"Save speed log (local)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:le.speedMonitoring.share,onChange:e=>ne(r=>({...r,speedMonitoring:{...r.speedMonitoring,share:e.target.checked}}))}),e.jsx("span",{children:"Share speed with contacts (sync rules)"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-medium mb-2",children:"Vehicle & Driver Conduct"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:le.conduct.reckless,onChange:e=>ne(r=>({...r,conduct:{...r.conduct,reckless:e.target.checked}}))}),e.jsx("span",{children:"Reckless driving observed"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:le.conduct.fatigueObserved,onChange:e=>ne(r=>({...r,conduct:{...r.conduct,fatigueObserved:e.target.checked}}))}),e.jsx("span",{children:"Driver fatigue observed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:le.conduct.notes,onChange:e=>ne(r=>({...r,conduct:{...r.conduct,notes:e.target.value}})),className:"w-full px-2 py-1 rounded border dark:bg-gray-700"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 rounded border",onClick:()=>{const e={ts:(new Date).toISOString(),serviceType:le.serviceType,vehicleType:le.vehicleType,capacity:le.capacity,occupiedSeats:le.seats.filter(e=>e.occupied).map(e=>e.id),additionalPassengers:le.additionalPassengers,mySeatId:le.mySeatId,speedLog:le.speedMonitoring.enabled?ee:[],conduct:le.conduct},r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(r),a=document.createElement("a");a.href=t,a.download=`lifesync-trip-${Date.now()}.json`,a.click(),URL.revokeObjectURL(t)},children:"Download Snapshot (JSON)"}),e.jsx("button",{className:"px-4 py-2 rounded bg-primary-600 text-white",onClick:async()=>{const e={serviceType:le.serviceType,vehicleType:le.vehicleType,capacity:le.capacity,totalPassengers:le.seats.filter(e=>e.occupied).length+(le.additionalPassengers||0)},r=`LifeSync Trip Snapshot\n${JSON.stringify(e,null,2)}`;if(navigator.share)try{await navigator.share({title:"LifeSync Trip Snapshot",text:r})}catch{}else navigator.clipboard&&(await navigator.clipboard.writeText(r),alert("Snapshot copied to clipboard"))},children:"Quick Share"}),e.jsx("button",{className:"px-4 py-2 rounded border",onClick:()=>{const e=encodeURIComponent("LifeSync Trip Snapshot"),r=encodeURIComponent(`Service: ${le.serviceType}\nVehicle: ${le.vehicleType}\nCapacity: ${le.capacity}\nOccupied: ${le.seats.filter(e=>e.occupied).length} (+${le.additionalPassengers})`);window.location.href=`mailto:?subject=${e}&body=${r}`},children:"Share via Email"}),e.jsx("button",{className:"px-4 py-2 rounded border",onClick:()=>{const e=encodeURIComponent("https://salatiso.com/lifesync"),r=encodeURIComponent(`LifeSync Trip: ${le.vehicleType}, capacity ${le.capacity}`);window.open(`https://twitter.com/intent/tweet?text=${r}&url=${e}`,"_blank")},children:"Share to X"}),e.jsx("button",{className:"px-4 py-2 rounded border",onClick:()=>{const e=encodeURIComponent("https://salatiso.com/lifesync");window.open(`https://www.facebook.com/sharer/sharer.php?u=${e}`,"_blank")},children:"Share to Facebook"})]})]})}),"my-rides"===P&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"My Rides"}),e.jsx("div",{className:"space-y-4",children:ue.map(r=>e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+("upcoming"===r.status?"bg-blue-500":"active"===r.status?"bg-green-500":"bg-gray-500")}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[r.from," → ",r.to]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["with ",r.driver," • ",new Date(r.departureTime).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:["R",r.price]}),e.jsx("div",{className:"text-sm capitalize "+("upcoming"===r.status?"text-blue-600":"active"===r.status?"text-green-600":"text-gray-600"),children:r.status})]})]})},r.id))})]})}),"active-ride"===P&&e.jsx("div",{className:"space-y-6",children:B?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:"Active Ride"}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(x,{className:"h-6 w-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900 dark:text-green-100",children:"Ride in Progress"}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"GPS tracking active • Emergency contacts notified"})]})]})}),e.jsx("div",{className:"border rounded-lg p-4 mb-6 "+("connected"===te?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"connecting"===te?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"error"===te?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"h-6 w-6 "+("connected"===te?"text-blue-600":"connecting"===te?"text-yellow-600":"error"===te?"text-red-600":"text-gray-600")}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Connectivity Status"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"connected"===te?"Connected and syncing":"connecting"===te?"Connecting...":"error"===te?"Connection error - check settings":"Idle"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:"/api/placeholder/60/60",alt:"Driver",className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Thabo Mthembu"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"h-4 w-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"4.8"}),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Toyota Corolla"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{className:"p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors",children:e.jsx(N,{className:"h-5 w-5"})}),e.jsx("button",{className:"p-3 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors",children:e.jsx(k,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>{null==B||B.id,(new Date).toISOString(),null==B||B.driver.emergencyContacts;setTimeout(()=>{confirm("Are you safe? Emergency will escalate in 30 seconds")},3e4)},className:"w-full p-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center space-x-3",children:[e.jsx(l,{className:"h-6 w-6"}),e.jsx("span",{className:"text-lg font-medium",children:"Emergency Alert"})]}),e.jsxs("button",{onClick:()=>handleGroupSync(B),className:"w-full p-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-3",children:[e.jsx(v,{className:"h-6 w-6"}),e.jsx("span",{className:"text-lg font-medium",children:"Manage Group Sync"})]})]}),K.length>0&&e.jsxs("div",{className:"mb-6 p-4 rounded border border-yellow-300 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-700",children:[e.jsx("div",{className:"font-medium mb-2 text-yellow-800 dark:text-yellow-100",children:"Proximity Alerts"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-900 dark:text-yellow-200",children:K.map(r=>e.jsxs("li",{children:[r.name," is ",r.distance,"m away from group"]},r.memberId))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(w,{className:"h-8 w-8 text-primary-500 mx-auto mb-2"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"GPS Active"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Real-time tracking"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(j,{className:"h-8 w-8 text-green-500 mx-auto mb-2"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Connected"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Strong signal"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx(S,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"85% Battery"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Device power"})]})]}),le.enabled&&e.jsxs("div",{className:"mt-6 p-4 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"font-medium mb-2",children:"Personal Sync Summary"}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Vehicle: ",le.vehicleType," • Service: ",le.serviceType]}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Capacity: ",le.capacity," • Occupied: ",le.seats.filter(e=>e.occupied).length," (+",le.additionalPassengers,")"]}),le.speedMonitoring.enabled&&e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:["Speed monitor active • Samples: ",ee.length]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"font-medium mb-2",children:"Anonymous Safety Feedback"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["Reckless driving","Driver fatigue","Suspicious passenger","Over capacity"].map(r=>e.jsx("button",{onClick:()=>(e=>{const r={id:"fb_"+Date.now(),reason:e,at:(new Date).toISOString()};W(e=>{var t;const a=[...e,r],s=Math.max(1,U.length||(null==(t=null==le?void 0:le.seats)?void 0:t.filter(e=>e.occupied).length)||1),i=a.length/s;return i>=.7?z({stage:"immediate-action",lastNotifiedAt:(new Date).toISOString()}):i>=.2&&z({stage:"double-knock",lastNotifiedAt:(new Date).toISOString()}),a})})(r),className:"px-3 py-1 text-sm rounded bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600",children:r},r))}),V.length>0&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:[V.length," report(s) submitted this trip"]})]}),e.jsxs("div",{className:"p-4 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"font-medium mb-2",children:"Escalation Status"}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Stage: ",Z.stage]}),Z.lastNotifiedAt&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last: ",new Date(Z.lastNotifiedAt).toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"mt-6 p-4 rounded border dark:border-gray-700",children:[e.jsx("div",{className:"font-medium mb-2",children:"Emergency Contacts"}),0===((null==G?void 0:G.contacts)||[]).length?e.jsx("div",{className:"text-sm text-gray-500",children:"No contacts configured"}):e.jsx("ul",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-1",children:((null==G?void 0:G.contacts)||[]).map((r,t)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[r.name," • ",r.role]}),e.jsx("a",{href:`tel:${r.phone}`,className:"text-primary-600",children:r.phone})]},t))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{if(confirm("End trip for you?")){stopTracking();try{ye.stop()}catch(e){}$(null),localStorage.setItem("lifesync_active_ride",null),D("my-rides"),X([]),z({stage:"completed",lastNotifiedAt:(new Date).toISOString()}),re([])}},className:"px-4 py-2 rounded bg-gray-800 text-white hover:bg-gray-700",children:"End Trip"})})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 text-center",children:[e.jsx(s,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Active Ride"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Book a ride to see real-time tracking and safety features here."}),e.jsx("button",{onClick:()=>D("find-ride"),className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Find a Ride"})]})})]})})};export{RideSharing as default};
