import{G as e,g as s,j as a}from"./index-0094ed61.js";import{r,u as t}from"./vendor-ea3cc270.js";import{g as i,e as l,d,i as n}from"./portableProfile-9e4e3ab8.js";import{k as o,aO as c,aD as x,c as g,aR as m}from"./ui-a8f8a709.js";import"./firebase-147eafc7.js";import"./i18n-80c88d68.js";const Settings=()=>{const{guestData:h}=r.useContext(e);t();const[y,u]=r.useState({autoSync:!0,manualOnly:!1,selectedCategories:["profile","services","trustVerification"]}),[f,p]=r.useState("mobile"),[b,v]=r.useState(!1),[j,N]=r.useState(""),[w,k]=r.useState(""),[S,C]=r.useState(""),[P,D]=r.useState(!1),[G,T]=r.useState(!1),[E,L]=r.useState(null),[I,O]=r.useState(!1),[M,F]=r.useState(!1),[z,V]=r.useState([]);r.useEffect(()=>{loadSettings(),initializeGoogleDrive()},[]);const initializeGoogleDrive=async()=>{try{await i.initialize(),O(i.isUserSignedIn())}catch(e){}},loadSettings=async()=>{var e;try{const a=(await s.listLocalProfiles()).find(e=>{var s,a;return e.displayName===(null==(s=null==h?void 0:h.profile)?void 0:s.firstName)+" "+(null==(a=null==h?void 0:h.profile)?void 0:a.lastName)});if(a){const e=await syncManager.getSyncPreferences(a.id);u(e)}p((null==(e=null==h?void 0:h.profile)?void 0:e.deviceType)||"mobile")}catch(a){}},handleSyncPreferencesChange=async e=>{const a={...y,...e};u(a);try{const e=(await s.listLocalProfiles()).find(e=>{var s,a;return e.displayName===(null==(s=null==h?void 0:h.profile)?void 0:s.firstName)+" "+(null==(a=null==h?void 0:h.profile)?void 0:a.lastName)});e&&(await syncManager.updateSyncPreferences(e.id,a),N("Sync preferences updated successfully"),setTimeout(()=>N(""),3e3))}catch(r){N("Failed to update sync preferences"),setTimeout(()=>N(""),3e3)}};return a.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx(o,{className:"w-8 h-8 text-blue-600"}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Settings"})]}),j&&a.jsx("div",{className:"p-4 rounded-lg "+(j.includes("success")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:j}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx(c,{className:"w-6 h-6 text-blue-600"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Sync Settings"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Sync Mode"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"radio",name:"syncMode",checked:y.autoSync&&!y.manualOnly,onChange:()=>handleSyncPreferencesChange({autoSync:!0,manualOnly:!1}),className:"w-4 h-4 text-blue-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Automatic Sync"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sync changes automatically when online"})]})]}),a.jsxs("label",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"radio",name:"syncMode",checked:y.manualOnly,onChange:()=>handleSyncPreferencesChange({autoSync:!1,manualOnly:!0}),className:"w-4 h-4 text-blue-600"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Manual Sync Only"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Only sync when you press the sync button"})]})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Data to Sync"}),a.jsx("div",{className:"space-y-3",children:[{id:"profile",label:"LifeCV & Profile",description:"Basic profile information and LifeCV data"},{id:"services",label:"Services & Enrollments",description:"Service registrations and history"},{id:"trustVerification",label:"Trust Verification",description:"Trust scores and verification data"},{id:"contacts",label:"Contacts & Relationships",description:"Contact list and relationship data"},{id:"assets",label:"Assets & Projects",description:"Asset tracking and project data"}].map(e=>a.jsxs("label",{className:"flex items-start gap-3",children:[a.jsx("input",{type:"checkbox",checked:y.selectedCategories.includes(e.id),onChange:s=>{const a=s.target.checked?[...y.selectedCategories,e.id]:y.selectedCategories.filter(s=>s!==e.id);handleSyncPreferencesChange({selectedCategories:a})},className:"w-4 h-4 text-blue-600 mt-1"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.label}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})]},e.id))})]}),a.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("button",{onClick:async()=>{v(!0);try{const e=(await s.listLocalProfiles()).find(e=>{var s,a;return e.displayName===(null==(s=null==h?void 0:h.profile)?void 0:s.firstName)+" "+(null==(a=null==h?void 0:h.profile)?void 0:a.lastName)});if(e){const s=await syncManager.manualSync(e.id);s.success?N(`Sync completed successfully. Synced: ${s.syncedCategories.join(", ")}`):N(`Sync failed: ${s.error}`)}}catch(e){N("Sync failed")}finally{v(!1),setTimeout(()=>N(""),5e3)}},disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:[a.jsx(c,{className:"w-4 h-4"}),b?"Syncing...":"Sync Now"]}),y.pendingChanges>0&&a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"bg-orange-500 text-white text-xs px-2 py-1 rounded-full",children:[y.pendingChanges," pending"]})})]}),y.lastSync&&a.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Last synced: ",new Date(y.lastSync).toLocaleString()]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx(x,{className:"w-6 h-6 text-green-600"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Performance"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Device Tier"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{id:"mobile",label:"Mobile",description:"Basic features, optimized for phones"},{id:"tablet",label:"Tablet",description:"Enhanced features, optimized for tablets"},{id:"desktop",label:"Desktop",description:"Full features, optimized for computers"},{id:"server",label:"Server",description:"Maximum features, for dedicated devices"}].map(e=>a.jsxs("label",{className:"flex items-start gap-3 p-4 border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",children:[a.jsx("input",{type:"radio",name:"deviceTier",value:e.id,checked:f===e.id,onChange:e=>p(e.target.value),className:"w-4 h-4 text-green-600 mt-1"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.label}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]})]},e.id))})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx(g,{className:"w-6 h-6 text-red-600"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Security"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Google Drive Integration"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:I?"Connected to Google Drive":"Connect to store profiles in Google Drive"})]}),a.jsx("div",{className:"flex items-center gap-2",children:I?a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx(c,{className:"w-5 h-5"}),a.jsx("span",{className:"text-sm font-medium",children:"Connected"}),a.jsx("button",{onClick:async()=>{try{await i.signOut(),O(!1),N("Signed out from Google Drive")}catch(e){N("Google Drive sign-out failed: "+e.message)}setTimeout(()=>N(""),5e3)},className:"text-xs text-red-600 hover:text-red-700",children:"Disconnect"})]}):a.jsx("button",{onClick:async()=>{try{await i.signIn(),O(!0),N("Successfully signed in to Google Drive")}catch(e){N("Google Drive sign-in failed: "+e.message)}setTimeout(()=>N(""),5e3)},className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 text-white rounded",children:"Connect"})})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Profile Export"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Export your profile for backup or migration"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>D(!0),className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded",children:"Local"}),a.jsx("button",{onClick:async()=>{if(I)if(w){v(!0);try{const e=await s.getLocalProfileData(null==currentProfile?void 0:currentProfile.id),a=await l(JSON.stringify(e),w),r=`lifesync-profile-${(null==currentProfile?void 0:currentProfile.name)||"default"}-${(new Date).toISOString().split("T")[0]}.lifesync`,t=await i.fileExists(r);t?(await i.updateFile(t,a),N("Profile updated on Google Drive successfully")):(await i.uploadFile(r,a),N("Profile exported to Google Drive successfully")),D(!1),k("")}catch(e){N("Export to Google Drive failed: "+e.message)}finally{v(!1),setTimeout(()=>N(""),5e3)}}else N("Please enter a password for encryption");else N("Please sign in to Google Drive first")},disabled:!I,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded",children:"Drive"})]})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Profile Import"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Import a previously exported profile"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>T(!0),className:"px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded",children:"Local"}),a.jsx("button",{onClick:async()=>{if(I){v(!0);try{const e=await i.listProfileFiles();V(e),F(!0)}catch(e){N("Failed to load Google Drive files: "+e.message)}finally{v(!1)}}else N("Please sign in to Google Drive first")},disabled:!I,className:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white rounded",children:"Drive"})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx(m,{className:"w-6 h-6 text-purple-600"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Data Management"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Local Storage"}),a.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Your data is stored locally on this device"})]}),a.jsx("div",{className:"text-sm text-gray-500",children:"IndexedDB"})]})}),a.jsx("div",{className:"p-4 border border-gray-200 dark:border-gray-600 rounded-lg",children:a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Data Categories"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Profile & LifeCV"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Services & Enrollments"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Trust Verification"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Contacts & Relationships"]})]})]})})]})]}),P&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Export Profile"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password for Encryption"}),a.jsx("input",{type:"password",value:w,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Enter a strong password"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:async()=>{if(w){v(!0);try{const e=(await s.listLocalProfiles()).find(e=>{var s,a;return e.displayName===(null==(s=null==h?void 0:h.profile)?void 0:s.firstName)+" "+(null==(a=null==h?void 0:h.profile)?void 0:a.lastName)});if(e){const s=await l(e.id,w),a=`lifesync-profile-${e.displayName.replace(/\s+/g,"-").toLowerCase()}-${(new Date).toISOString().split("T")[0]}.lifesync`;d(s,a),N("Profile exported successfully"),D(!1),k("")}else N("No profile found to export")}catch(e){N("Export failed: "+e.message)}finally{v(!1),setTimeout(()=>N(""),5e3)}}else N("Please enter a password for encryption")},disabled:!w||b,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:b?"Exporting...":"Export"}),a.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})]})]})]})}),G&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Import Profile"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Profile File"}),a.jsx("input",{type:"file",accept:".lifesync",onChange:e=>{const s=e.target.files[0];s&&s.name.endsWith(".lifesync")?L(s):N("Please select a valid .lifesync file")},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-white file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password for Decryption"}),a.jsx("input",{type:"password",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Enter the export password"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:handleImportProfile,disabled:!E||!S||b,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:b?"Importing...":"Import"}),a.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})]})]})]})}),M&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Select Profile from Google Drive"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Password for Decryption"}),a.jsx("input",{type:"password",value:S,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"Enter the export password"})]}),a.jsx("div",{className:"space-y-2",children:z.length>0?z.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>(async e=>{if(S){v(!0);try{const s=await i.downloadFile(e);await n(s,S),N("Profile imported from Google Drive successfully. Please refresh the page."),F(!1),C("")}catch(s){N("Import from Google Drive failed: "+s.message)}finally{v(!1),setTimeout(()=>N(""),5e3)}}else N("Please enter the password for decryption")})(e.id),children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),a.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Modified: ",new Date(e.modifiedTime).toLocaleString()]})]}),a.jsx(c,{className:"w-5 h-5 text-red-600"})]},e.id)):a.jsx("div",{className:"text-center text-gray-500 py-4",children:"No LifeSync profile files found in Google Drive"})}),a.jsx("div",{className:"flex gap-3",children:a.jsx("button",{onClick:()=>F(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"})})]})]})})]})};export{Settings as default};
