<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeCV - Your Digital Life Portfolio</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Remove CSS links that cause 404 errors - Tailwind handles the styling -->
    <style>
        /* Essential CSS inline to avoid server issues */
        .hidden { display: none !important; }
        .show { display: block !important; }
        .rotate-180 { transform: rotate(180deg); }
        .notification { max-width: 400px; word-wrap: break-word; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .accordion-content { display: none; transition: all 0.3s ease; }
        .accordion-content.show { display: block; }
        .search-matched { border-color: #3b82f6 !important; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important; }
    </style>
</head>

<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 font-sans">
    <!-- Loading Indicator -->
    <div id="loading-indicator" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto mb-4"></div>
            <p class="text-lg text-slate-600">Loading LifeCV...</p>
        </div>
    </div>

    <!-- Error Boundary -->
    <div id="error-boundary" class="fixed inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <div class="text-red-600 text-6xl mb-4">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2">Something went wrong</h2>
            <p class="text-slate-600 mb-4">We're having trouble loading the LifeCV module.</p>
            <button onclick="location.reload()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                Try Again
            </button>
        </div>
    </div>

    <div id="app-container" class="flex h-screen">
        <!-- Sidebar Placeholder -->
        <div id="sidebar-placeholder"></div>

        <!-- Main Content Wrapper -->
        <div class="main-content-wrapper flex-1 flex flex-col">
            <!-- Header Placeholder -->
            <div id="header-placeholder"></div>

            <main class="content-area flex-1 overflow-y-auto p-6">
                <div class="max-w-7xl mx-auto">
                    <!-- Search Section -->
                    <div class="search-section">
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <div class="relative">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                                    <input type="text" id="section-search" placeholder="Search sections, fields, or data..." 
                                           class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <button onclick="clearSearch()" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors">
                                <i class="fas fa-times mr-2"></i>Clear
                            </button>
                        </div>
                        <div id="search-results" class="mt-3 hidden">
                            <p class="text-sm text-slate-600 mb-2">Search results:</p>
                            <div id="search-results-list" class="space-y-2"></div>
                        </div>
                    </div>

                    <!-- Dashboard Placeholder -->
                    <div id="lifecv-dashboard-placeholder"></div>

                    <!-- Main LifeCV Sections -->
                    <div id="lifecv-sections-container" class="mt-8">
                         <h2 class="text-2xl font-bold text-slate-700 dark:text-slate-300 mb-4">Your LifeCV</h2>
                         <div id="lifecv-sections" class="space-y-4">
                            <!-- Sections will be rendered here by JavaScript -->
                         </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Camera elements for the camera service -->
    <div id="camera-elements" style="display: none;">
        <video id="webcam-video" autoplay muted></video>
        <canvas id="capture-canvas"></canvas>
        <video id="webcam-video-modal" autoplay muted></video>
        <canvas id="capture-canvas-modal"></canvas>
    </div>

    <!-- Modals will be injected here -->
    <div id="modal-placeholder"></div>
    
    <!-- Notification Container -->
    <div id="notification-container" class="fixed bottom-5 right-5 z-[100]"></div>

    <!-- Load components first -->
    <script>
        // Load header and sidebar from the correct app.js system
        // Remove the component loading since app.js handles this
        document.addEventListener('DOMContentLoaded', () => {
            // Let app.js handle the UI components
        });
    </script>

    <!-- Core App Scripts - Add these BEFORE the life-cv module -->
    <script type="module" src="../assets/js/firebase-config.js"></script>
    <script type="module" src="../assets/js/app.js"></script>
    
    <!-- Main JavaScript module -->
    <script type="module" src="../assets/js/modules/life-cv.js"></script>
    
    <script>
        // Global error handlers
        const showError = (message) => {
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorBoundary = document.getElementById('error-boundary');
            
            if (loadingIndicator) loadingIndicator.classList.add('hidden');
            if (errorBoundary) {
                errorBoundary.classList.remove('hidden');
                const errorMessage = errorBoundary.querySelector('p');
                if (errorMessage) errorMessage.textContent = message;
            }
        };

        window.addEventListener('error', (event) => {
            // Ignore Chrome extension errors
            if (event.message && event.message.includes('Extension context invalidated')) {
                return;
            }
            if (event.message && event.message.includes('message channel closed')) {
                return;
            }
            console.error('Global error caught:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            // Ignore Chrome extension promise rejections
            if (event.reason && event.reason.message && event.reason.message.includes('message channel closed')) {
                event.preventDefault();
                return;
            }
            console.error('Unhandled promise rejection:', event.reason);
        });

        // Initialize LifeCV when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Wait a moment for components to load
                setTimeout(async () => {
                    if (typeof initLifeCV !== 'undefined') {
                        await initLifeCV();
                    } else {
                        console.error('initLifeCV function not found');
                        showError('Failed to initialize LifeCV module.');
                    }
                }, 100);
            } catch (error) {
                console.error('Error during LifeCV initialization:', error);
                showError('Failed to start LifeCV. Please refresh the page.');
            }
        });
    </script>
</body>
</html>
